# Livepeer Whitepaper

**Протокол и экономические стимулы для децентрализованной сети потокового видео**

Дуг Петканикс <doug@livepeer.org>  
Эрик Тан <eric@livepeer.org>

## Аннотация ###########################################

Проект Livepeer предназначен для предоставления сетевого протокола прямых видеотрансляций, являясь полностью децентрализованным, хорошо масштабируемым, стимулируемым крипто-токенами и поэтому может служить хорошим решением медиа-уровня для организации прямых видеотрансляций в стеке децентрализованной разработки (web3). Кроме этого, Livepeer способен обеспечить экономически эффективную альтернативу централизованным вещательным решениям для ныне существующих вещателей. В этом документе описывается протокол Livepeer - протокол на основе делегирования доли для безопасного и игрового способа стимулирования участников сети потокового видео вещания. Мы представляем решение для масштабируемой проверки децентрализованно выполненных заданий, а также для предотвращения бесполезной работы в попытке получить токены, эмитируемые инфляционной системой.

## Оглавление ###########################################

* [Введение и предыстория](#Введение-и-предыстория)
    * [Стек видео-технологий](#Стек-видео-технологий)
* [Протокол Livepeer](#Протокол-Livepeer)
    * [Сегменты видео](#Сегменты-видео)
    * [Токен Livepeer](#Токен-Livepeer)
    * [Роли в протоколе](#Роли-в-протоколе)
    * [Консенсус](#Консенсус)
    * [Связывание и делегирование](#Связывание-и-делегирование)
    * [Транзакция Transcoder()](#Транзакция-Transcoder)
    * [Вещание и задания по транскодированию](#Вещание-и-задания-по-транскодированию)
        * [Предварительная обработка](#Предварительная-обработка)
        * [Задание](#Задание)
        * [Окончание выполнения задания](#Окончание-выполнения-задания)
    * [Проверка выполненного задания](#Проверка-выполненного-задания)
        * [Примечание по Truebit](#Примечание-по-Truebit)
    * [Генерация токенов](#Генерация-токенов)
    * [Сокращение](#Сокращение)
    * [Распределение токенов](#Распределение-токенов)
    * [Управление](#Управление)
* [Атаки](#Атаки)
    * [Атаки на консенсус](#Атаки-на-консенсус)
    * [DDoS](#ddos)
    * [Бесполезный или замкнутый на себе транскодер](#Бесполезный-или-замкнутый-на-себе-транскодер)
    * [Проблемы для транскодера](#Проблемы-для-транскодера)
    * [Реорганизация блокчейна](#Реорганизация-блокчейна)
* [Распространение потокового видео](#Распространение-потокового-видео)
* [Возможности для применения](#Возможности-для-применения)
    * [Потребление контента по принципу Pay-As-You-Go](#Потребление-контента-по-принципу-Pay-As-You-Go)
    * [Автоматически масштабируемые социальные видео сервисы](#Автоматически-масштабируемые-социальные-видео-сервисы)
    * [Журналистика без цензуры](#Журналистика-без-цензуры)
    * [Видео с поддержкой DApps](#Видео-с-поддержкой-DApps)
* [Резюме](#Резюме)
* [Приложение](#Приложение)
    * [Справочник по параметрам протокола Livepeer](#Справочник-по-параметрам-протокола-Livepeer)
    * [Типы транзакций в протоколе Livepeer](#Типы-транзакций-в-протоколе-Livepeer)
* [Ссылки](#Ссылки)

*Примечание: этот документ был первоначально опубликован в апреле 2017 года. В декабре 2018 года было сделано предложение по масштабированию платформы под названием «Streamflow», в котором изложены следующие шаги и усовершенствования некоторых идей, представленных ниже. Почитать о [Streamflow можно здесь] (https://github.com/livepeer/wiki/blob/master/STREAMFLOW.md).*

## Введение и предыстория #################################################

Концепция децентрализованной сети начала воплощаться в жизнь 2 года назад с появлением сетей, таких как [Ethereum](http://ethereum.org), [Swarm](http://swarm-gateways.net/bzz:/theswarm.eth/) для обеспечения надежных вычислений, [IPFS/Filecoin](http://ipfs.io) для обеспечения децентрализованного хранения и распространения контента, биткойн и различных токенов для облегчения p2p-передачи ценностей, децентрализованных реестров имен, таких как [Blockstack](http://blockstack.org), [ENS](http://ens.readthedocs.io/en/latest/introduction.html) для предоставления человеко-ориентированных названий для контента и идентификаторов. Эти элементы формируют основу для децентрализованных приложений (DApps), которые должны быть построены в форме в основном статического или редко обновляемого веб или мобильного контента, но в настоящий момент DApps по-прежнему не имеют возможности включать в себя потоковое мультимедиа и потоковые данные открытым и децентрализованным способом. Цель проекта Livepeer - децентрализовать прямые видеотрансляции через Интернет.

[Обзор проекта Livepeer](https://github.com/livepeer/wiki/wiki/Project-Overview) дает хорошее представление о текущем состоянии прямых видеотрансляций в Интернете. В этом техническом документе основное внимание будет уделено деталям криптоэкономического протокола Livepeer, а не конкретным его применениям, однако можно сказать, что текущие технологии потокового вещания в этом обзоре описываются как быстро растущее, централизованные и дорогие. С другой стороны, полностью децентрализованное p2p-решение, в котором узлы производили бы свои собственные вычисления и предоставляли бы канал для передачи данных, было бы более открытым и масштабируемым, поскольку в нем не было бы ограничения на количество обслуживаемых соединений.

Безусловно, эта технология уже в определенной степени доступна, но на сегодняшний день все еще не создано никаких стимулов для того, чтобы пользователи запускали узлы, реализующие этот функционал, и не получено надлежащего финансирования для разработки открытого протокола, который сможет сделать эту технологию выгодной для всего интернета, а не для одной централизованной компании. Однако, с недавним появлением протоколов на основе крипто-токенов [[2, 3](#Ссылки)], появилась возможность одновременно стимулировать пользователей предоставлять вычислительные мощности и пропускную способность для прямых видеотрансляций таким образом, чтобы это способствовало финансированию разработки решения с открытым медиасервером, способного передавать потоковое видео в соответствии со всеми последними стандартами и форматами для охвата всего спектра устройств. Можно также ожидать, что затраты для вещателя на использование сети Livepeer могут быть значительно ниже, чем стоимость любого централизованного решения.

По мере реализации технологии и протокола Livepeer, пользователи смогут участвовать в нем следующим образом:

1. Вещатель будет захватывать видео при помощи камеры, телефона, экрана или веб-камеры и отправлять его в сеть Livepeer.
2. Узлы, обслуживающие сеть Livepeer, будут кодировать этот видеопоток во все необходимые форматы для всех поддерживаемых устройств. Пользователи, использующие эти узлы, будут поощряться за счет комиссионных, выплачиваемых вещателем в ETH, и возможностью создать репутацию при помощи токена протокола, чтобы получить право брать на себя больше заданий по транскодированию в будущем.
3. Любой пользователь сети Livepeer сможет запросить просмотр видеопотока, и он автоматически получит его в режиме реального времени.

<img src = "https://monosnap.com/image/dnUxXlppntsBmIcptXvOtbztqEySwt" alt = "Пример работы сети Livepeer" style = "width: 750px">

### Стек видео-технологий

Технологический стек для трансляции видео в прямом эфире развивался на протяжении многих лет и на данный момент содержит множество слоев. Вещателям необходимо захватывать видео источника, взаимодействовать с медиасервером для обработки и транскодирования видео в различные форматы, распространять видео по сети, а затем разрешать конечному потребителю воспроизводить видео с высоким качеством картинки. Есть также вопросы экономического характера, которые возникают при проектировании данного стека, например, должны ли вещатель или потребитель платить за канал передачи видеоданных.

Типичная платформа для потокового вещания сегодня должна поддерживать такие видео форматы как RTMP, HLS, Mpeg-Dash, кодеки H.264 и VP8. Новые кодеки, такие как H.265/HEVC, VP9 и AV1, в ближайшем будущем станут весьма популярными, так как потребители все больше будут привыкать к высокому качеству видео. Только для HLS [Apple предлагает](https://developer.apple.com/library/content/documentation/General/Reference/HLSAuthoringSpec/Requirements.html#//apple_ref/doc/uid/TP40016596-CH2-SW1) битрейты от 145 кбит/с до 7800 кбит/с для обслуживания всевозможных устройств в различных условиях. Все это значительно усложняет процесс и стоимость прямой видеотрансляции.

Существующий децентрализованный стек разработки (web3) содержит решения для некоторых уровней, необходимых для платформы потокового видео, таких как передача файлов и оплата, но в настоящее время нет решений для захвата, интерфейса, транскодирования и обработки, а также для обслуживания различных слоев видеопотока. По этой причине Livepeer представляет [Livepeer Media Server (LPMS)] (https://github.com/livepeer/wiki/wiki/Livepeer-Media-Server) - реализацию медиа-сервера с открытым исходным кодом, которая предоставляет все функции потокового видео, необходимые разработчикам DApp и существующим вещателям для использования в своих приложениях. [Подробнее об этом читайте здесь](https://github.com/livepeer/wiki/wiki/Livepeer-Media-Server).

Любой разработчик, конечно же, может создать отдельное приложение поверх LPMS, но оно все равно будет централизованным и его необходимо будет масштабировать с помощью традиционных средств. Однако, когда каждый узел сети Livepeer работает с LPMS, а экономические стимулы протокола гарантируют, что эти узлы будут предоставлять свою вычислительную мощность и пропускную способность для реализации транскодирования и распространения видеопотока, **таким образом "pay-as-you-go" сеть (сеть, в которой пользователь платит по мере получения услуги) с автоматическим само-масштабированием становится доступной для разработчиков, которые могут просто отправлять в нее свои прямые трансляции и получать подробные сведения о масштабировании, оплате и медиа-хостинге**.

## Протокол Livepeer ###########################################

Протокол Livepeer определяет, каким образом различные участники в экосистеме прямых видеотрансляций используют сеть безопасным и экономически рациональным образом. Два важнейших момента, которые необходимо учитывать протоколу, это фактическое распространение потокового видео от источника к большому числу потребителей рациональным и масштабируемым способом, а также экономические стимулы для поощрения участия в сети в безопасной и игровой манере. Хотя этот технический документ будет в основном описывать технологию распространения потокового видео, мы будем много внимания уделять экономике процесса, чтобы продемонстрировать безопасность и экономическую согласованность. Итак, на самом высоком уровне протокол предназначен для того, чтобы:

- Разрешить любому узлу отправлять видеопоток в сеть и, при желании, платить за его перекодирование в различные форматы и битрейты.
- Разрешить любому узлу запрашивать видео из сети.
- Разрешить участникам добавлять свои вычислительные мощности и пропускную способность через службу транскодирования и распространения видео и получать соответствующее вознаграждение.

В децентрализованной сети, где участники получают вознаграждение пропорционально объему работы, который они сделали, для обеспечения безопасности необходимо решить две проблемы:

- Можем ли мы проверить, что работа, выполненная узлами, была выполнена правильно?
- Вознаграждаются ли узлы за реальную и полезную для сети работу, а не за поддельную, выполненную лишь для того, чтобы обманным путем получить токены?

Протокол Livepeer предназначен как для проверки выполненной работы, так и для предотвращения фальсификации работы, а также предлагает решения для автоматического масштабирования сети и обеспечивает управление развитием протокола с течением времени.

### Сегменты видео

Основная медиа единица в Livepeer - это то, что мы будем называть «сегментом». Сегмент - это отрезок мультиплексированного аудио и видео продолжительностью `t`. Каждый сегмент в сети Livepeer уникален и содержит криптографическое свидетельство, подтверждающее, что вещатель приготовил эти конкретные данные для этого конкретного сегмента. Каждый поток состоит из множества последовательных сегментов, каждый из которых содержит порядковый номер, обеспечивающий их правильный порядок. Сегмент содержит следующие поля:

| Поле видео сегмента | Описание |
|--------| --------|
| **StreamID** | Определяет исходный узел и поток, которому принадлежит этот сегмент. |
| **SequenceNumber** | Порядковый номер этого сегмента в исходном потоке. |
| **DataPayload** | Метаданные в двоичном виде и аудио/видео данные этого сегмента. |
| **DataHash** | Хэш полезных данных. |
| **BroadcasterSignature** | Подпись вещателя `Priv(StreamID, SequenceNumber, hash(StreamID, SequenceNumber, DataHash))`, которая позволяет проверить и подтвердить, что это истинные данные для этого уникального сегмента. |

Протокол Livepeer использует видео сегменты в качестве единиц работы для транскодирования, распространения данных и платежей.

### Токен Livepeer

Токен Livepeer (LPT) является токеном протокола сети Livepeer. Но он не является средством для оплаты выполненных заданий. При трансляции видео в сети для этой цели вещатели используют токен Ethereum'а (ETH). Узлы, которые вносят вклад в обработку и пропускную способность, получают ETH в виде комиссионных от вещателей. LPT - это токен для обозначения доли (staking), который используют участники, желающие выполнять задания сети, чтобы скоординировать распределение заданий по сети и обеспечить безопасность выполнения заданий (задания должны выполняться правильно и честно). На LPT возлагаются следующие задачи:

- В сети Livepeer, основанной на консенсусе Delegated Proof of Stake (DPOS), он служит механизмом связывания (bonding), в котором доля (stake) делегируется транскодерам (или валидаторам), участвующим в протоколе для реализации транскодирования видео и проверки заданий. Токен LPT и механизм его сокращения (в случае нарушения правил протокола) необходимы для защиты сети от ряда атак. Подробнее об этом смотрите ниже.
- Он распределяет задания между узлами сети пропорционально количеству делегированных узлам токенов, реализуя, по сути, механизм координации.
- Он является единицей учета для экосистемы Livepeer, с помощью которой формируется основа для концепции SectorCoin, применимой к дополнительному функционалу, реализуемому в будущем [[4](#Ссылки)]. Такие сервисы, как DVR, субтитры, вставка/монетизация рекламы и аналитика, смогут подключаться к экосистеме Livepeer и рассчитывать на безопасность, которую обеспечивает механизм ставок при помощи токена LPT.

Первоначальное распределение токена Livepeer будет происходить таким образом, чтобы заинтересованные стороны смогли начать выполнять различные роли в сети, а затем, в соответствии с определенным алгоритмом, будут выпускаться дополнительные токены. Смотрите раздел [Распределение токенов](#Распределение-токенов).

В соответствии с соглашениями Ethereum и многих популярных токенов стандарта ERC20 [[16](#Ссылки)], LPT будет делиться на 10 ^ 18, причем более крупные номиналы, такие как сам LPT, будут предназначены для использования на транзакциях пользовательского уровня, таких как механизм ставок (staking), а меньшие номиналы будут предназначены для расчетов на уровне протокола.

### Роли в протоколе

Прежде чем продолжить, давайте определим роли в сети, чтобы используемые при описании протокола термины были понятны. Узел Livepeer - это любой компьютер, на котором запущено программное обеспечение Livepeer.

| Роль узла | Описание |
|--------|-----------|
| **Broadcaster** | Узел Livepeer, который отправляет видеопоток в сеть **("вещатель")**. |
| **Transcoder** | Узел Livepeer, выполняющий работу по кодированию потока в другой кодек, битрейт или формат упаковки **("транскодер")**. |
| **Relay Node** | Узел Livepeer, который участвует в распространении видеопотока и передаче протокольных сообщений, но не обязательно выполняет какое-либо транскодирование **("ретранслятор")**. |
| **Consumer** | Узел Livepeer, запрашивающий поток. Может просматривать его или отправлять через шлюз на свои приложения или пользовательские DApp **("потребитель")**. |

В дополнение к вышеуказанным ролям, которые играют пользователи, использующие узлы Livepeer, протокол также будет ссылаться на определенные системы и платформы. Хотя мы используем сейчас конкретные системы, они могут быть заменены другими, обеспечивающими аналогичную функциональность и криптоэкономические гарантии:

| Роль системы | Описание |
|-------|----------|
| **Swarm** | Платформа хранения, в которой адресация данных основывается на самих данных. Данные могут быть гарантированно временно доступны во время процесса проверки по протоколу SWEAR [[7, 12](#Ссылки)]. *(Обратите внимание, что в этом документе мы ссылаемся на Swarm, но другие аналогичные платформы для хранения данных могут заменить Swarm, если доступность данных в них будет гарантирована с более высокой вероятностью).* |
| **Livepeer Smart Contract** | Смарт-контракт, работающий в сети Ethereum [[1](#Ссылки)]. |
| **Truebit** | Протокол проверки черного ящика, который гарантирует правильность вычислений, размещенных в блокчейне (дорогой ценой) [[6](#Ссылки)]. (<http://truebit.io>) |

Вот визуальный обзор ролей и способов их взаимодействия друг с другом в процессе проверки работы, описанном ниже.

<img src = "https://monosnap.com/image/mFehdXXtxzFThoKRx7bdcha6QWrZ7p.png" alt = "Визуальный обзор протокола" style = "width: 750px">

*Сегменты, поступающие от вещателя к транскодеру и, в конечном итоге, к потребителю. Транскодер обеспечивает наличие подписей и доказательств выполнения работы (proof of work) для участия в процедуре проверки работы.*

**Примечание по транскодерам:** Транскодеры играют наиболее важную роль в экосистеме Livepeer. Так как именно они принимают входящий поток и с нужной скоростью преобразуют его во множество различных форматов для распространения с низкой задержкой (low latency distribution). Таким образом, получаемое ими вознаграждение напрямую зависит от их высокой доступности, эффективного, мощного оборудования (возможно, с ускоренным транскодированием при помощи GPU), каналов связи с высокой пропускной способностью и надежных методов DevOps. Текучка среди транскодеров должна происходить в значительно меньшей степени, чем среди других участники сети, так как если они берут на себя задание по перекодированию потока, а затем вдруг выходят из сети, это очень плохо сказывается на работоспособности всей системы. Несмотря на то, что сеть может масштабироваться для поддержания множества участников, играющих роль транскодеров (и участвующих в получении токенов), в процедуре назначения на роль транскодера участвует большинство пользователей сети для того, чтобы обеспечить итоговую надежность, представляющую ценность для вещателей. Подробнее об этом назначении на роль транскодера ниже.

### Консенсус

Livepeer имеет двухуровеневую систему консенсуса. При этом операции с LPT и транзакции защищены базовым блокчейном, таким как Ethereum. Вследствие чего любая передача токена LPT или любая транзакция в системе может считаться подтвержденной с той же надежностью, что и базовое доказательство сети Ethereum. При этом второй уровень консенсуса определяет распределение вновь выпущенных токенов LPT. Он регулируется смарт-контрактом Livepeer и различными участниками протокола. Несмотря на то, что с точки зрения принятия и проверки предыдущих блоков никакого консенсуса не требуется, этот протокол определяет правила участия и условия, на которых действующие лица будут наказаны (сокращение токенов) за невыполнение своей роли.

Этот второй уровень консенсуса, регулирующий вновь выпущенный токен, использует Delegated Proof of Stake (DPOS) благодаря вдохновению от таких систем как Bitshares, Steem, Tendermint и Casper [[5, 9, 10, 11](#Ссылки)]. Роль валидаторов в сети играют транскодеры. При этом любой пользователь может делегировать свою долю (stake) транскодеру, которому затем необходимо выполнять задания транскодирования в сети, принимать участие в протоколе проверки выполненных заданий и вызывать системные функции через определенные промежутки времени. Протокол будет распределять получаемые за транскодирование комиссионные (fees) и сгенерированные LPT токены так, что это будет сокращать долю (stake) участников, действующих против правил протокола. Результат проверки будет зафиксирован при помощи Truebit после того, как эта проверка будет выполнена, поэтому для споров между вещателем и транскодером просто не будет места.

### Связывание и делегирование

В Livepeer чтобы обозначить свою долю в сети, узлы должны сделать связывание (bonding) некоторого количество своих LPT токенов. Сделать это можно при помощи транзакции `Bond()`, которая будет осуществлять связывание доли в смарт-контракте до тех пор, пока не будет сделана транзакция `Unbond()`, после которой узел войдет в состояние `unbonding`, которое будет длиться в течение времени `UnbondingPeriod`. По завершении `UnbondingPeriod` несвязанные LPT токены можно будет вывести.

Количество связанных (bonded) LPT токенов указывает, какая доля делегируется транскодеру. При этом сеть на постоянной основе поддерживает `N` активных транскодеров, и это число является изменяемым параметром сети. Любой узел может указать, что он хочет быть транскодером с помощью транзакции `Transcoder()`. Протокол в начале каждого раунда выбирает `N` транскодеров с наибольшей совокупной долей (собственные LPT + делегированные LPT от других узлов) вместе с одним случайным транскодером из списка ожидания.

Узел, делегировавший часть своих LPT токенов транскодеру, называется "связанным" (bonded). Вновь сгенерированный LPT токен распределяется между связанными узлами пропорционально объему работы, с которым они связаны (за вычетом сборов транскодера). Но только если они делегированы транскодерам, которые ведут себя по правилам протокола. Если же транскодеры, которым они делегированы, не ведут себя как полагается и выполняется одно из условий сокращения, связанные узлы могут потерять часть своих LPT (токены будут уменьшены на определенный процент). Связанные узлы также получают часть комиссионных в ETH, которые транскодер получает благодаря выполнению заданий по транскодированию. То есть, транскодеры, выполняющие задания, получают комиссионные в ETH, которые вещатели платят им за эту работу.

В дальнейшем, когда в этом документе используется термин "делегатор" (delegator), подразумеваются связанные узлы, которые делегировали свою долю кандидату в транскодеры, а не себе самому в качестве транскодера.

Таким образом, участники могут захотеть связать свою долю LPT с тем или иным транскодером по следующим причинам:

- Чтобы делегировать свою долю эффективным транскодерам, которые будут хорошо выполнять свои функции, повышая ценность сети для вещателей.
- Чтобы повысить репутацию и в будущем получать больше результатов работы в форме вновь выпущенных токенов пропорционально доле.
- Чтобы зарабатывать комиссионные с транскодеров.
- Чтобы, возможно, самому стать транскодером.

### Транзакция Transcoder()

Узел указывает свою готовность быть транскодером, отправляя в сеть транзакцию Transcoder(), которая содержит следующие три параметра:

- `PricePerSegment`: самая низкая цена, которую транскодер готовы принять для транскодирования сегмента видео.
- `BlockRewardCut`: процент вознаграждения за блок, который связанные узлы будут платить им за услугу транскодирования. (Например, 2%. Если связанный узел должен будет получить 100 LPT в награду за блок, то 2 LPT он отдаст транскодеру).
- `FeeShare`: процент от комиссионных за вещание, которым транскодер готов поделиться со связанными узлами, делегировавшими ему свои LPT. (Например, 25%. Если транскодер получит 100 ETH в качестве вознаграждения, он заплатит 25 ETH связанным узлам).

Транскодеры могут обновлять информацию о себе и о своей доступности вплоть до времени `RoundLockAmount` до начала следующего раунда транскодирования. Это значение указывается в % от раунда. (Например, 10% == 2,4 часа. Транскодеры могут изменить эту информацию за 2,4 часа до следующего раунда транскодирования, который длится `RoundLength` 1 день). Это дает возможность связанным узлам сравнить между собой значения комиссионных сборов и расценок за вещание транскодеров и, при желании, переместить свою долю. В начале раунда транскодирования (инициируемого вызовом транзакции `InitializeRound()`) на основе суммарной доли, делегированной каждому транскодеру, определяются активные транскодеры для этого раунда, при этом доли и параметры комиссиионных у транскодеров фиксируются на время этого раунда.

Во время `RoundLockPeriod` допускается одно изменение: минимальная предлагаемая цена/сегмент для любого кандидата в транскодеры зафиксирована и не может быть изменена, при этом кандидаты в транскодеры с более высокой ценой могут снизить свою цену/сегмент. Это позволит им соответствовать самой низкой цене, предлагаемой в сети. В течение этого периода им не разрешается повышать предложенную цену.

Вот пример параметров транскодера, которые делегат может изучить для принятия решения о том, кому делегировать свои LPT.

| Transcoder ID | PricePerSegment | BlockRewardCut | FeeShare |
|----|----|----|----|
| 1 | 22 wei | 1% | 25% |
| 2 | 30 wei | 2% | 40% |
| 3 | 10 wei | 4% | 1% |
| ... | ... | ... | ... |
| N | 14 wei | 0% | 2% |

*Примечание о цене: в этом документе мы указываем цену/сегмент. В действительности, Livepeer планирует использовать модель, основанную на учете газа, в которой есть понятие единиц газа, необходимых для определенных параметров работы сегмента, таких как битрейт, кодирование, размер кадра и т.д. Цена/сегмент - это прием, при котором экономические стимулы такие же, но в действительности транскодеры скорее всего будут сообщать цену/газ.*

### Вещание и задания по транскодированию

Транскодеры, которые готовы для работы в сети, бросают свою шляпу в ринг для заданий транскодирования, отправляя транзакцию `TranscodeAvailability()`. Это действие говорит об их доступности и помещает их в пул транскодеров, доступных для приема нового задания.

Когда вещатель отправляет свой поток в сеть Livepeer, ему присваивается `StreamID`. Это служит уникальным идентификатором и содержит адрес узла источника, чтобы другие узлы знали, как запрашивать и куда направлять запросы на использование этого потока. Поток содержит много последовательных `сегментов`, как описано в разделе [Сегменты видео](#Сегменты-видео). Если вещатель хочет, чтобы сеть позаботилась о транскодировании его потока во все форматы и битрейты, необходимые для любого пользователя на любом устройстве, тогда первым шагом является отправка транзакции с заданием транскодирования в блокчейн. Заданиям также присваивается уникальный идентификатор, а входные параметры для задания состоят из:

`Job (StreamID, TranscodingOptions, PricePerSegment)`

`TranscodingOptions` определяет итоговые битрейты, форматы, кодировки и т.д., А `PricePerSegment` содержит цену, которую предлагает вещатель.

Как только эта транзакция будет добыта (будет подписан блок с этой транзакцией), хэш следующего блока будет использоваться для псевдослучайного определения транскодера для этого задания. Будут учитываться все транскодеры с ценой, которая ниже или равна предложенной цене, а хэш блока деленный по модулю на число возможных транскодеров (определенных по их долям) будет определять индекс выбранного транскодера.

Теперь вещатель может начать потоковую передачу видео сегментов в направлении транскодера, и они будут использоваться в описываемом протоколе. Протокол также использует решение для постоянного хранения, например Swarm, как часть процесса проверки работы.

#### Предварительная обработка

1. **Broadcaster** -> **Livepeer Smart Contract**: отправляет депозит в блокчейн, чтобы покрыть полную стоимость выполнения задания транскодирования. Это может быть в любой момент сделано и позже, однако транскодер может прекратить работу, если депозит вдруг закончится, поскольку он получает деньги за выполняемую работу постепенно.

#### Задание

2. **Broadcaster** -> **Livepeer Smart Contract**: Job(streamID, options, price/segment)
    - Создает запрос на задание в блокчейне и помещает некоторое количество ETH на депозит для оплаты работы.
3. Протокол может использовать хэш следующего блока для детерминированного выбора подходящего транскодера для этого задания.
4. **Transcoder** -> **Broadcaster**: отправляет сгенерированный streamID и квитанцию (receipt) о том, что задание принято.
5. **Broadcaster** -> **Transcoder**: отправляет сегменты потока, которые содержат подписи для проверки входных данных.
6. **Transcoder** выполняет транскодирование и делает новый выходной поток доступным для сети.
7. **Transcoder**: сохраняет квитанцию транскодирования для каждого транскодированного сегмента. Квитанция транскодирования имеет следующие поля.

| Поле квитанции транскодирования | Описание |
|-------|------------|
| **StreamID** | Определяет исходный узел и поток, которому принадлежит этот сегмент. |
| **Sequence Number** | Порядковый номер данного сегмента в исходном потоке. |
| **Input Data hash** | Хэш полезных данных входного сегмента. |
| **Transcoded Data hash** | Хэш выходных данных после транскодирования этого сегмента. |
| **Broadcaster segment signature** | Подпись от вещателя Priv(StreamID, Seq#, Dhash), которую можно использовать для подтверждения и проверки того, что это подлинные данные для этого уникального сегмента. |
| **Transcoder segment signature** | Сигнатура всех вышеперечисленных полей от транскодера, подтверждающая, что это конкретное выходное транскодирование было выполнено на этом конкретном входе. |

Всякий раз, когда транскодер замечает, что он больше не получает сегменты, он может вызвать `ClaimWork()` для запроса работы.

#### Окончание выполнения задания

10. **Transcoder** -> **Livepeer Smart Contract**: Вызов `ClaimWork(JobID, StartSegmentSeq#, EndSegmentSeq#, MerkleRoot)`. Транскодер заявляет в блокчейн, что он выполнил работу над указанным диапазоном сегментов, с указанием корня дерева Меркла, в котором находятся все данные квитанций транскодирования для фиксации содержимого этих закодированных сегментов.
11. Ждем пока эта транзакция будет добыта, и смотрим на хэш следующего блока. Затем протокол может определить, какие сегменты будут проверены, основываясь на `VerificationRate`.
12. **Transcoder** -> **Swarm**: Пишем полезные данные (payload) входящего потока для сегментов, которые будут проверены с помощью параметров SWEAR, чтобы гарантировать, что данные будут там достаточно долго для осуществления процедуры проверки (в течение `VerificationPeriod`).
13. **Transcoder** -> **Livepeer Smart Contract**: Предоставляем в блокчейн заявки на проверку всех проверяемых сегментов вместе с доказательствами Меркла для квитанций для каждого сегмента в заявках на транскодирование. Смарт-контракт сможет проверить подписи от вещателя (Broadcaster) и **транскодера**, чтобы убедиться, что все необходимые для проведения проверки данные доступны, и сможет проверить доказательства Меркла в отношении предоставленного корня Меркла из `ClaimWork()`.
14. **Transcoder** -> **Truebit**: `Verify()`. Это вызов смарт-контракта Truebit через блокчейн, где транскодер предоставляет входящий хэш Swarm'а для проверяемого сегмента. (Подробнее о проверке в следующем разделе)
15. **Truebit** -> **Livepeer Smart Contract**: результат выполнения задания записывается в блокчейн. Он сравнивается с результатом заявки на транскодирование, который предоставил транскодер.
16. **Livepeer Smart Contract**: на данный момент смарт-контракт Livepeer содержит всю информацию, необходимую для определения того, проверена ли работа транскодера.
    - Если проверка успешно пройдена, то она используется в качестве входных данных для алгоритма выпуска новых токенов и разблокирования депозита для оплаты работы по транскодированию.
    - Если проверка не пройдена, то транскодер и узлы, делегировавшие ему свои LPT получают штраф (сокращение) в размере `FailedVerificationSlashAmount`, а средства возвращаются вещателю.

Вещатель (Broadcaster) может прекратить отправку сегментов в любой момент, который фактически является моментом `EndJob()`.

На этом этапе было выполнено транскодирование, было заявлено о доказательстве работы в блокчейн, и было сообщено о неудачной или успешной проверке работы. В блокчейне теперь находится вся информация, необходимая для того, чтобы определить распределение комиссионных и токенов для транскодеров и делегаторов, или сократить их в случае неудачной проверки. Давайте посмотрим, как именно проверяется выполненное задание.

### Проверка выполненного задания

Чтобы назначить плату транскодерам, которые утверждают, что они выполнили задание по транскодированию потока, необходимо, чтобы протокол мог с высокой вероятностью определить, что задание действительно было выполнено правильно. Для этого Livepeer использует [протокол Truebit](http://truebit.io) [[6](#Ссылки)].

Truebit работает так, что после того как один участник (исполнитель) выполнит фактическую работу за некоторую плату, в нашем случае это задача по транскодированию, другие участники (верификаторы) проверяют результат на наличие сбоев, ошибок или мошенничества. Задача разбита на очень маленькие подзадачи, и верификаторы проверяют работу исполнителя до тех пор, пока не обнаружат первую подзадачу, которая отличается от ожидаемой. Затем, лишь только эта одна очень маленькая подзадача должна быть выполнена в блокчейне с помощью смарт-контракта (судья), который в итоге сможет сказать, какая сторона выполнила работу правильно. Экономические стимулы (вклчающие в том числе и искусственно создаваемые ошибки, стимулирующие проверку со стороны верификаторов) гарантируют, что нецелесообразно обманывать или недобросовестно осуществлять проверку результатов, но выгодней проверять выполненную работу как следует.

Недостатком этого протокола является то, что его использование стоит от 5x-50x стоимости исходной работы. Livepeer использует Truebit в качестве черного ящика для проверки сегментов, но при этом мы делаем это без необходимости платить очень высокий налог на проверку, проверяя только небольшой процент сегментов, выбранных случайным образом, и используя сокращение (slashing) в случае неудаче при проверке. `VerificationRate`, установленный в Livepeer, определяет, как часто должен быть выбран конкретный сегмент для проверки через Truebit, а случайность хэша будущего блока после записи работы в блокчейне определяет, какие именно сегменты выбираются для проверки.

Если работа выполняется с помощью вызова `ClaimWork()` в блоке `N`, то

Если `Sha3(N, BlockHash(N), Seg#) % VerificationRate == 0`, то сегмент # должен быть проверен.

Транскодер предоставляет заявки на транскодирование (Transcode Claims) в блокчейн для сегментов-кандидатов, вызывая транзакцию `Verify()`. Livepeer Smart Contract сможет проверить подлинность этих заявок, используя внутренние подписи и предоставленные доказательства Меркла, а затем сделать вызов Truebit для проверки только лишь этих сегментов.

Исполнители и верификаторы Truebit получают доступ к входным данным для сегмента из системы постоянного хранения с адресацией на основе хранимых данных, такой как Swarm. Транскодер отвечает за проверку того, что данные сегмента доступны в Swarm, и может при желании искать квитанции по протоколу SWEAR [[5](#Ссылки)], гарантируя постоянство в течение определенного периода времени, которого достаточно для Truebit, чтобы сделать свое дело. Кроме того, они могут взять на себя работу узла Swarm, обеспечивающего доступность данных для проверки через Truebit. Если у них есть основания полагать, что данные недоступны в Swarm, они могут предоставить их или просто вызвать `ClaimWork()` для ранее доступных данных.

Truebit запишет результаты вычислений (успешная или неудачная проверка) обратно в смарт-контракт Livepeer, который затем можно будет использовать в расчетах вознаграждения и сокращения в протоколе. Узел транскодирования не может заранее предсказать, какие сегменты будут проверены, и в случае мошенничества или неудачного транскодирования будут происходить следующие штрафы:

- `FailedVerificationSlashAmount` произойдет сокращение, если не будет пройдена проверка через Truebit.
- `MissedVerificationSlashAmount` произойдет сокращение, если транскодер не сможет предоставить заявки на транскодирование, и произойдет вызов Truebit на сегментах, которые он должен был обработать.
- Потеря комиссионных от вещателя.
- Сокращение будет применено не только к транскодеру, но и ко всем его делегаторам. Они примут это во внимание при принятии следующего решения о том, кому делегировать, а транскодеру грозит потеря прибыльной работы.

Важно добиться того, что более выгодным решением будет просто поставить LPT на корректно и добросовестно работающий транскодер, вместо того, чтобы пытаться обмануть и попадать под штрафы, продолжая при этом собирать комиссионные и выпускаемые токены за нечестную работу. Этого можно достичь путем тщательного подбора параметров сокращения (slashing) и интенсивности проверки.

#### Примечание по Truebit

*Несмотря на то, что протокол использует Truebit для обеспечения полностью ненадежной проверки работы, на практике может оказаться необходимым использовать доступные решения, которые обеспечивают проверку без той степени доверия, которую Truebit может предложить, пока Truebit все еще находится в стадии разработки и тестирования. Вот некоторые варианты, упорядоченные по степени ненадежности:*

*1. Oracle на основе Livepeer API - мы доверяем сети Livepeer при проверке вычислений. Очень централизованное решение, подходящее, пожалуй, только для тестирования.*
*2. Oraclize Computation Service - мы доверяем компании, которая предоставляет доказательства вычислений и чья репутация полностью зависит от размещения внешних данных в блокчейне с доказательствами того, что они не были подделаны.*
*3. Безопасные аппаратные анклавы - такие службы, как Intel SGX или TownCrier, предоставляют надежные вычислительные среды. В этом случае, мы верим в то, что их аппаратная реализация является правильной и безопасной. Можно применить децентрализацию и проверку.*

### Генерация токенов

Система Livepeer является инфляционной, так как новые токены будут генерироваться и распределяться в соответствии с расписанием, приведенным ниже в разделе [Распределение токенов](#Распределение-токенов). Если все участники сети Livepeer ведут себя в соответствии с протоколом, то новые сгенерированные токены будут распределяться пользователям пропорционально их суммарной доле (за вычетом сборов). Транскодеры берут на себя вызов функции `Reward()` для запуска процедуры создания или сокращения токенов, опираясь на данные, доступные через блокчейн.

Каждый транскодер должен будет вызывать `Reward()` один раз за раунд.

- Проверяем, что `Reward()` вызывается активным транскодером.
- Проверяем, что транскодер еще не вызывал `Reward ()` в этом раунде.
- Вычисляем количество токенов, которые необходимо создать на основе `InflationRate`. Производим вычисленное количество токенов.
- Рассчитываем долю транскодера на основе `BlockRewardCut`.
- Добавляем эту долю к доле транскодера.
- Распределяем остаток токенов среди делегаторов.
- Обновляем количество связанных токенов для этого транскодера.

Неспособность вызвать `Reward()` приводит к потере части выпускаемых токенов и портит репутацию транскодера.

### Сокращение

Как уже упоминалось ранее, вот условия для сокращения:

- Ошибка при проверке
- Неспособность вызвать проверку, когда это требуется
- Не выполняется пропорциональное распределение запрашиваемой работы в рамках платформы на основе делегированной доли

Одно из преимуществ построения в экосистеме Ethereum - это преимущество сетевого эффекта, которое вы получаете от возможности строить свою систему поверх других протоколов, таких как Truebit и Swarm/SWEAR. К сожалению, при опоре на эти внешние системы, которые сами по себе имеют внешние зависимости, возникает вероятность того, что какая-либо ошибка или слабость в одном из этих протоколов может привести к процедуре сокращения токенов в Livepeer.

Например, если задание проверки Truebit находилось в их очереди в течение длительного периода времени без какого-либо исполнителя или верификатора, Livepeer не получит результат этой проверки за время до вызова `Reward()`. Проблема также может возникнуть, если в сети Swarm происходит разделение и она не может вовремя предоставить файл верификатору Truebit.

Эти риски могут быть смягчены если так или иначе заинтересовать участников протокола Livepeer брать эти роли на себя, то есть служить верификаторами Truebit и узлами Swarm. Но есть и другой подход, который представляет собой концепцию порогов вероятности для параметров сокращения. Необязательные переменные протокола, такие как `VerificationFailureThreshold`, могут быть установлены так, чтобы указывать, что пока узел проходит, например, 99% проверок, сокращения не будет. Этот подход будет являться еще одной областью исследований, которой мы будем заниматься пока сеть еще не развернута.

Проблема с запуском проверки условия сокращения может быть обнаружена любым участником протокола Livepeer. Существует `FinderFee`, который задает процент от суммы сокращения, которую нашедший получит в качестве награды за успешный вызов этого условия сокращения.

Оставшаяся часть выделенных средств попадет в `CommonPool`, который может быть уничтожен или распределен для общих целей, таких как дальнейшее развитие экосистемы, в соответствии с механизмом управления протоколом.

### Распределение токенов

В качестве токена, который представляет возможность участвовать и выполнять работу в сети с помощью алгоритма DPoS, первоначальное распределение токенов Livepeer будет следовать шаблонам других систем DPoS, которые требуют изначально широкого распространения токена.

Первоначально выпущенные токены будут распространены среди сообщества в генезис-блоке и на ранних этапах существования сети. Получатели могут использовать токен для участия в роли транскодера или делегатора. Часть будет выделена группам, которые внесли свой вклад в предварительную работу и выделяли деньги для протокола до его создания, а часть будет выделена для долгосрочного развития проекта.

После запуска сети выдача токенов будет продолжаться в соответствии с инфляционным графиком с генерацией на уровне `InflationRate` за раунд относительно неактивных токенов. Поскольку токен выдается пропорционально доле всех связанных участников протокола, он служит для стимулирования активного участия. Участники «защищены» от этой инфляции, поскольку получают свою пропорциональную долю. Только неактивные участники, хранящие токен, не связывая его для участия в протоколе, увидят, что их пропорциональное владение сетью ослабляется этой инфляцией.

Начальная цель для `InflationRate` будет установлена таким образом, чтобы она была направлена на стимулирование приблизительно `ParticipationRate` связанных LPT и активного участия [[19](#Ссылки)). Например, если 'ParticipationRate' составляет 50%, то будут существовать стимулы для связывания половины неактивных токенов. Уровень инфляции будет алгоритмически изменяться каждый раунд, чтобы заинтересовать участников. Более высокий уровень инфляции побуждает людей связывать (bond) больше токенов, а более низкий уровень побуждает людей хранить токены несвязанными, в более ликвидном виде. Экономические стимулы должны привести к некоторому балансу в процентном соотношении между ликвидностью и владением сетью.

### Управление

Роль управления в протоколе Livepeer является тройственной:

1. Определять сожжение или распределение общих средств, которые были получены в результате сокращения из-за ненадлежащего поведения узлов.
2. Настраивать параметры сети, чтобы обеспечить здоровую, процветающую сеть, которая будет полезна для вещателей.
3. Вызывать предложенные обновления протокола децентрализованным способом.

Многие сетевые параметры, упомянутые в этом документе, такие как `UnbondingPeriod`, `RoundLength`, `ParticipationRate` и `VerificationRate`, являются настраиваемыми. Предложения по настройке этих параметров могут быть отправлены в сеть, и далее процесс управления, включая голосование транскодеров пропорционально их делегированной доле, будет автоматически определять принятие этих изменений в протоколе. Подробная спецификация для управления оставлена для другого документа. [Подробнее здесь](https://github.com/livepeer/wiki/wiki/Governance).

## Атаки

В этом разделе содержится обзор различных способов, которыми злоумышленники могут попытаться атаковать сеть Livepeer. Мы используем рациональную модель атакующего, в которой атакующий принимает решения на основе своих собственных экономических интересов. Ряд атак снижается за счет того, что такие атаки невыгодны, но мы также стремимся к тому, чтобы в худшем случае сеть не давала сбоев и страдала лишь снижением эффективности в случае устойчивой атаки, не связанной с получением прибыли.

### Атаки на консенсус

Как упоминалось ранее, консенсус в экосистеме Livepeer обеспечивается базовой платформой блокчейна (например, Ethereum). Для атаки 51%, атаки двойной траты токена Livepeer и форка сети потребуются те же ресурсы, что и для атаки на сам Ethereum.

Livepeer - это протокол, основанный на долях (stake), и хотя транскодеры играют роль в процессе проверки работы и в процессе распределения вознаграждений, у них фактически нет обязанности участвовать в процедуре проверки или в процессе принятия заданий от других транскодеров. Они ничего не знают про блокчейн и про проверку предыдущих блоков. Для них просто существуют экономические стимулы для проверки своей собственной работы и получения своей части выпускаемых токенов. Таким образом, атаки, которые существуют для proof-of-stake сетей, такие, например, как Long Range атака, проблема Nothing at Stake и атака подкупом (The Bribe), невозможны, поскольку нельзя попытаться подписать несколько блоков или попытаться создать более длинную цепь из более раннего состояния. Однако следует помнить, что, поскольку базовая цепочка блоков Ethereum переходит на PoS, эти атаки могут возникнуть, если выгода от их проведения для Livepeer превысит стоимость атаки на сам Ethereum.

Хотя полагаться на безопасность лежащего в основе блокчейна полезно для предотвращения согласованных атак, все еще существует класс качественных и эффективных атак, которые могут нанести вред сети Livepeer.

### DDoS

Отказ в обслуживании (DDoS) в Livepeer может происходить двумя способами:

1. Транскодер может попытаться предотвратить или замедлить передачу вещателем своего закодированного потока в сеть, принимая работу, но отказываясь ее транскодировать.
2. Вещатель может помешать транскодеру выполнять порученную ему работу, отказываясь отправлять ему сегменты.

Обе атаки имеют определенную цену и могут быть нейтрализованы с небольшими последствиями.

В первом случае транскодер должен заплатить, чтобы заявить о своей доступности в сети. Если он не собирается получать плату, потому что не выполняет задания, то он теряет ETH. Вещатель может просто повторно отправить задание и таким образом поручить его другому транскодеру. Одним из возможных вариантов масштабируемости является то, что протокол может выявить определенное количество правильно работающих транскодеров в виде списка с указанием приоритета, и таким образом вещатель может просто переходить от одного транскодера к другому без необходимости совершать дополнительные транзакции. Кроме того, все статистические данные о принятых заданиях и среднее количество транскодированных/находящихся в работе сегментов можно рассчитать на основе данных в блокчейне, и делегаторы будут использовать это в качестве анализируемых данных при принятии решения о том, кому делегировать свои токены. Будешь вести себя плохо, потеряешь свою роль в сети.

В случае, если вещатель не позволяет транскодеру выполнять работу, это решается просто расчетом планируемой мощности. Узел транскодирования может хранить записи о своей емкости для параллельных заданий, вероятности того, что задание будет активным/неактивным, и гарантировать, что у него всегда будет свободная мощность для задания, которое он запрашивает. Простое игнорирование или вызов `EndJob()` на узле, который отказывается отправлять сегменты, вряд ли повредит транскодеру.

### Бесполезный или замкнутый на себе транскодер

Если транскодер имеет достаточно связанных токенов для поддержания активного состояния, он теоретически может перечислить 100% `BlockRewardCut`, 0% `FeeShare` и взимать высокий `PricePerSegment`, так что ему никогда не придется выполнять какую-либо работу, но он может получать выпускаемые токены. Этому препятствует параметр `CompetitivenessTolerance`, который требует, чтобы он выдал определенный объем выполненных заданий. Кроме того, из-за транзакционных издержек участия в протоколе, которые несут транскодеры, для них было бы более выгодно просто поставить свой токен на другой активный транскодер, который делился бы с ними еще и комиссионными, чем действовать в качестве бесполезного транскодера, который не будет получать никаких комиссионных.

Неправильно работающий транскодер, который выдает некорректный выходной поток, будет быстро урезан до такой степени, что его доля станет слишком низкой, чтобы фактически сохранить свое активное состояние и получать новые задания.

### Проблемы для транскодера

Если вещатель хочет сделать протокол очень дорогим для транскодера, он может посылать транскодерам непоследовательные номера сегментов. Это связано с тем, что транскодеры могут претендовать на работу для непрерывного диапазона номеров сегментов в одной транзакции, но для выполнения заявки в разных диапазонах номеров сегментов потребуется много транзакций. От этого можно защититься с помощью следующих параметров:

1. Транскодер вызывает `EndJob()` и не беспокоится о том, чтобы выполнить задание или пытаться получить комиссионные.
2. Протокол реализует синтаксический анализ блокчейна или лучшее кодирование заявок сегментов, чтобы уменьшить расходы, связанные с запросом непоследовательных сегментов в одном вызове.
3. Просто игнорировать такие сегменты и не брать их в работу.

Эта атака дорого обходится вещателю, так как он должен иметь депозит и отправлять задания в блокчейн, чтобы для начала вообще получить назначение на транскодер. Эта атака способна помешать работе транскодера и потенциально снизить его эффективность, но не нанесет ущерб сети.

### Реорганизация блокчейна

Когда вещатель передает задание в смарт-контракт Livepeer, протокол использует хеш текущего блока, чтобы определить, какому транскодеру будет назначено задание. Реорганизации базового блокчейна могут вызвать путаницу в этом сценарии. Хотя это не совсем «атака», транскодер будет в рабочем состоянии в течение одной секунды, а затем сразу после реорганизации базового блокчейна больше не сможет работать. При обнаружении реорганизации вещатель может либо перенаправить поток на новый действующий транскодер, либо протокол может обнаружить uncle-блоки, включенные в основную цепочку, и считать, что транскодер в рабочем состоянии, если uncle-блок находится в пределах определенного порогового значения.

## Распространение потокового видео ###########################################

В этом документе основное внимание уделялось экономическим вопросам и протоколу для обеспечения надлежащего транскодирования потокового видео, что необходимо для осуществления потоковой передачи видео с адаптивным битрейтом на любые устройства. Но не менее важным является распространение данных видеопотока по сети, чтобы он был получен потребителем в высоком качестве и с низкой задержкой. Экономика распространения видеопотока основывается на учете пропускной способности по принципу «один за другим», который уже был популяризован Bittorrent и расширяется с помощью таких протоколов, как SWAP [[13](#Ссылки)]. Проще говоря, одни узлы получают плату за обработку сегмента видео, а другие узлы платят за обработку сегмента видео. Ситуация складывается выгодным образом, если у узла уже есть сегмент и он может отправить его на несколько узлов-заказчиков. Мы называем этот тип узла `узлом ретрансляции` (Relay node).

Когда речь идет о пропускной способности узлов, играющих разные роли в сети, мы видим различные интересы участников.

* Потребители могут захотеть предоставить свой пропускной канал для раздачи контента другим потребителям в обмен на возможность бесплатного просмотра видео. Можете изучить такие системы, как Webtorrent [[14](#Ссылки)].
* Вещатели служат исходными узлами и могут взимать плату за потребление видео или могут платить за пропускной канал, чтобы все желающие могли получить бесплатный доступ к этому видео.
* Транскодеры и ретрансляторы готовы предоставить полосу пропускания для распространения видео, если это выгодно. Это похоже на роль традиционных CDN.

С `сегментами` в качестве основного блока данных, проходящих через сеть, можно реализовать учет полосы пропускания «один за другим», используя ETH в качестве основы для расчета. Мы заимствуем абстракцию контракта чековой книжки (Chequebook Contract) от Swarm [[6](#Ссылки)] в качестве метода оплаты за пределами блокчейна (offchain) при расчете в блокчейне. Будущие разработки в экосистеме, включая сеть Raiden [[15](#Ссылки)], могут также позволить для этой цели использовать каналы платежей. Поскольку передача токена является для протокола нативным действием, возможно встроить цены, связанные с контентом, непосредственно в протокол. Вещатель может брать плату непосредственно за время или контент, а узлы в этом случае будут выбирать потоки исходя из наболее высокого соотношения цена/сегмент.

Важно отметить, что хотя плата за полосы пропускания может быть использована для повышения рентабельности запуска ретрансляционных узлов, которые просто передают видео сегменты по сети для увеличения ее емкости подобно CDN, эти узлы стимулируются лишь спросом на контент и не стимулируются выпуском новых токенов. Фактически, поток данных от сети Livepeer может быть отправлен в традиционную CDN (например, Amazon S3, Cloudflare и т.д.) или децентрализованную CDN (например, IPFS или Swarm). Разработка однорангового протокола для доставки видео сегментов является возможностью для оптимизации и повышения производительности сети.

Было показано, что одноранговые CDN снижают требования к полосе пропускания на 80-98% по отношению к исходному серверу CDN [[17](#Ссылки)], а механизмы, основанные на токенах, существующие в децентрализованных сетях, способны стимулировать заинтересованные стороны разрабатывать и обслуживать открытые версии существующих сегодня проприетарных P2P CDN. Протокол PPSPP [[18](#Ссылки)] служит вполне жизнеспособным кандидатом для открытой реализации сети, ориентированной на доставку потокового контента.

Так как эта тема не является критически важной для криптоэкономики протокола Livepeer, детальный ее разбор в этом документе отсутствует, однако все заинтересованные могут [следить](https://github.com/livepeer/go-livepeer) за тем как происходит разработка, и в будущем обнаружить документ, посвященный исключительно протоколу распространения видео.

## Возможности для применения ###########################################

Проект Livepeer направлен на децентрализацию прямой трансляции видео «один ко многим» (многоадресная передача). Это самая лучшая форма работы средств массовой информации, поскольку она позволяет вещателю напрямую общаться со своей аудиторией без каких-либо интерпретаций и подмен. Это дает каждому желающему возможность выражать свое мнение при помощи этой платформы. Существующие централизованные решения могут пострадать от цензуры, контроля над пользовательскими данными/отношениями/монетизацией со стороны третьих лиц, а также неэффективной структурой затрат на оплату услуг. Вот некоторые из логичных вариантов использования приложений и сервисов на основе Livepeer.

### Потребление контента по принципу Pay-As-You-Go 

Благодаря транзакцям по передаче токенов обладающих ценностью, встроенных в протокол, вещатели смогут напрямую взимать со зрителей плату за использование их прямых трансляций, не требуя пластиковой карты, учетной записи или контроля личности пользователя через централизованную платформу. Такой функционал будет полезен для образовательных каналов (плата за посещение онлайн-курса), каналов с мероприятиями (плата за просмотр концерта или спортивного мероприятия в прямом эфире), развлекательных каналов (плата за просмотр прямого эфира геймера или исполнителя) и многих других вариантов использования - все это при сохранении конфиденциальности зрителя и возможности платить непосредственно вещателю и только за потребленный контент.

### Автоматически масштабируемые социальные видео сервисы

Одной из проблем создания потребительских видеоуслуг сегодня является масштабирование инфраструктуры для поддержания растущего числа видеопотоков и растущего числа потребителей по мере прибавления новых пользователей. Сервисный уровень, который позволяет разработчикам легко приступить к созданию решения для видеосвязи поверх сети Livepeer, который будет автоматически масштабироваться для поддержания любого количества видеопотоков и зрителей по мере их поступления, станет желанным решением для разработчиков инфраструктуры, которым в противном случае пришлось бы продолжать выделять на это сервера, лицензировать медиа-сервисы и эффективно управлять ресурсами в ситуациях пиковых нагрузок.

### Журналистика без цензуры

Современные платформы, такие как Twitter и Facebook, предоставляют потрясающие видео-решения для широкой аудитории, но они также первыми блокируют или подвергают цензуре в случае политических конфликтов. Использование децентрализованной сети, такой как Livepeer, сделало бы почти невозможным предотвратить распространение информации о том, что действительно происходит на местах в режиме реального времени.

### Видео с поддержкой DApps

Существуют децентрализованные приложения (DApps), управляемые в основном экосистемой Ethereum. Однако до настоящего времени не было жизнеспособного решения для встраивания потокового видео в DApp без использования централизованного решения или ограничения количества клиентов-потребителей на основании ограничений WebRTC. Применяя Livepeer в разработке, приложение может быть полностью децентрализовано, но в то же время может использовать потоковое видео в любом масштабе.

## Резюме ###########################################

Таким образом, протокол Livepeer стимулирует узлы выделять свою вычислительную мощность и пропускную способность для осуществления транскодирования и распространения потокового видео. Проверка работоспособности решается с помощью масштабируемого расширения поверх протокола Truebit, которое стимулирует узлы правильно выполнять операции транскодирования, чтобы получать свои комисионные и выпускаемые токены LPT и сохранять свою роль транскодера. Проблема геймификации сети и фальсификации работы решается экономически, с помощью вознаграждений в системе delegated proof of stake. С экономической точки зрения становится более рациональным просто привязывать свои токены к полезному для сети транскодеру, чем платить за выполнение мнимой работы.

Конечным результатом является масштабируемая сеть с возможностью оплаты по мере использования (pay-as-you-go) для децентрализованной прямой трансляции видео - отсутствующий слой в стеке web3, который Livepeer стремится восполнить.

## Приложение ###########################################

### Справочник по параметрам протокола Livepeer

| Имя параметра | Описание | Пример значения |
|----|------|---|
| `T` | Длина сегмента в секундах | 2 секунды |
| `N` | Количество активных транскодеров | 144 |
| `RoundLength` | Промежуток времени между определением активных транскодеров для нового раунда | 1 день |
| `InflationRate` | Текущий целевой уровень инфляции за раунд LPT. (Изменяется алгоритмически). | .04% (эквивалент 15% / год) |
| `ParticipationRate` | Целевой процент связанных токенов. | 50% |
| `RoundLockAmount` | В конце раунда параметры транскодеров фиксируются на величину процента от продолжительности раунда, так что делегаторы имеют возможность просматривать информацию и делегировать, не беспокоясь, что параметров будут изменены в последнюю минуту. | 10% == 2,4 часа |
| `UnbondingPeriod` | Временной промежуток между моментом перехода в состояние unbonding и возможностью вывода средств. | 1 месяц |
| `VerificationPeriod` | Крайний срок для подтверждения заявки на работу после ее подачи. Этот период также служит минимальным периодом, в течение которого необходимо отправить квитанцию о целостности данных в систему децентрализованного хранения. | 6 часов |
| `VerificationRate` | % сегментов, которые будут проверены. | 1/500 |
| `FailedVerificationSlashAmount` | % сокращения в случае неудачной проверки (за пределами допустимого порога ошибок) | 5% |
| `MissedRewardSlashAmount` | % сокращения в случае пропуска награды за раунд (возможно, стоить делать это только в случае n последовательных пропусков) | 3% |
| `MissedVerificationSlashAmount` | % сокращения в случае, если транскодер не вызвал процедуру проверки | 10% |
| `CompetitivenessTolerance` | Если бы все транскодеры всегда были доступны и устанавливали одинаковую цену и комиссионные, они получали бы работу пропорционально их доле (stake). Этот параметр устанавливает % того, что они должны находиться в пределах этого целевого рабочего %, чтобы иметь право на вновь выпущенные токены. Это препятствует транскодерам выполнять очень небольшую часть работы по отношению к их доле. | 90% (Крайний пример. Со 100 транскодерами и 100 000 сегментами это означает, что я ОК, если я сделал лишь 100 сегментов (10% из 1000, которые я должен был сделать)). |
| `*SlashingThresholds` (TBD) | Заполнитель, чтобы указать, что мы можем делать сокращения не за каждый сбой, а только сбои, превышающие некоторый частотный порог. | |
| `VerificationFailureThreshold` | % проверок, которые вы можете не пройти и при этом не получить сокращения токенов. Полезноый параметр,  так как существуют внешние системы, подобные Swarm и Truebit, которые могут приводить к случайным сбоям. | 1% |
| `FinderFee` | % от суммы сокращения, которую обнаруживший нарушение протокола получит в качестве компенсации. | 5% |
| `SlashingPeriod` | Крайний срок для вызова сокращения после завершения `VerificationPeriod`. | 1 час |

### Типы транзакций в протоколе Livepeer

| Транзакция | Описание |
|----|------|
| `Bond()` | Привязать некоторую долю токенов (stake) к транскодеру. |
| `Unbond()` | Войти в состояние отвязывания токенов, которое будет длиться на протяжении `UnbondingPeriod`. |
| `Transcoder()` | Объявить о намерении быть транскодером. |
| `ResignAsTranscoder()` | Заявить об отмене своих намерений быть транскодером. |
| `TranscodeAvailability()` | Этот транскодер в настоящее время открыт для принятия задания. Транскодеры находятся в пуле и при отправке новых заданий назначаются случайным образом. |
| `Job()` | Отправить задание по транскодированию в блокчейн. |
| `EndJob()` | Завершить выполнение задания, чтобы указать на окончание транскодирования. |
| `Deposit()` | Внести депозит в блокчейн, который будет использоваться для постепенной оплаты выполненных заданий. |
| `Withdraw()` | Снятие с депозита и получение несвязанной доли (unbonded stake). |
| `ClaimWork()` | Завершить выполнение задания транскодирования и с помощью диапазона сегментов и корня Меркла указать, какие сегменты были проверенно транскодированы. |
| `DistributeFees()` | С ее помощью транскодер заявляет о комиссионных после проверки. |
| `Reward()` | Транзакция выполняет все проверки на основе блокчейна для либо сокращения, либо начисления новых токенов. Может быть вызвана один раз за раунд только транскодером, который активен в текущем раунде. |
| `Verify()` | Транскодер предоставляет заявки на транскодирование для сегментов, которые будут проверены с использованием доказательств Меркла, при помощи корня Меркла из `ClaimWork()`. Обращается к Truebit для выполнения процедуры проверки. |
| `InitializeRound()` | Эту транзакцию необходимо вызвать один раз после стартового блока нового раунда, чтобы инициализировать новый активный пул транскодеров. |
| `UpdateDelegatorStake()` | Эта транзакция позволяет делегатору делать заявку на свои комиссионные и получать вновь выпущенные токены из предыдущих раундов. Транзакция вызывается автоматически при выполнении транзакций связывания и отвязывания, но является отказоустойчивой на тот случай, если делегатор захочет провести обновление без изменения состояния. |
| `*GovernanceTransactions()` | TBD |

## Ссылки ###########################################

1. Ethereum White Paper - Vitalik Buterin - Ethereum Wiki - <https://github.com/ethereum/wiki/wiki/White-Paper>
2. Fat Protocols - Joel Monegro - USV Blog - <http://www.usv.com/blog/fat-protocols>
3. Crypto Tokens and the Coming Age of Protocol Innovation - Albert Wenger - <http://continuations.com/post/148098927445/crypto-tokens-and-the-coming-age-of-protocol>
4. The Case For SectorCoins - Eric Tang - <https://medium.com/@ericxtang/case-for-sectorcoins-b70a7c820c2d#.7892n4a57>
5. Delegated Proof-of-Stake Consensus - Daniel Larimer - <https://bitshares.org/technology/delegated-proof-of-stake-consensus/>
6. Truebit - Jason Teutsch and Christian Reitweisner - <https://people.cs.uchicago.edu/~teutsch/papers/truebit.pdf>
7. swap, swear and swindle, incentive system for swarm - viktor trón, aron fischer, dániel a. nagy, zsolt felföldi, nick johnson - <http://swarm-gateways.net/bzz:/theswarm.eth/ethersphere/orange-papers/1/sw%5E3.pdf>
8. Kademlia: A Peer-to-peer Information System Based On The XOR Metric - Petar Maymounkov and David Mazieres <https://pdos.csail.mit.edu/~petar/papers/maymounkov-kademlia-lncs.pdf>
9. Steem Whitepaper - Daniel Larimer, Ned Scott, Valentine Zavgorodnev, Benjamin Johnson, James Calfee, Michael Vandeberg - <https://steem.io/SteemWhitePaper.pdf>
10. Introducing Casper "the Friendly Ghost" - Vlad Zamfir - <https://blog.ethereum.org/2015/08/01/introducing-casper-friendly-ghost/>
11. Tendermint Docs - Jae Kwon and Ethan Buchman - <https://tendermint.com/docs>
12. Swarm - <http://swarm-gateways.net/bzz:/theswarm.eth/>
13. Incentives Build Robustness in BitTorrent - Bram Cohen - <http://bittorrent.org/bittorrentecon.pdf>
14. WebTorrent - <https://webtorrent.io/>
15. Raiden Network - <http://raiden.network/>
16. ERC20 Token Standard - <https://github.com/ethereum/EIPs/issues/20>
17. Peer5 leverages viewers’ devices for a P2P approach to streaming video - <https://techcrunch.com/2017/01/26/peer5-y-combinator/>
18. Peer-to-Peer Streaming Peer Protocol - <https://tools.ietf.org/html/rfc7574>
19. Inflation and Participation in Stake Based Protocols - Doug Petkanics - <https://medium.com/@petkanics/inflation-and-participation-in-stake-based-token-protocols-1593688612bf>
