# Livepeer Streamflow Paper

**Масштабируемость сети Livepeer на Ethereum посредством введения оркестраторов, вероятностных микроплатежей и согласования потока заданий без использования блокчейна**

**Авторы**
Дуг Петканикс <doug@livepeer.org>
Йондон Фу <yondon@livepeer.org>

**Исследователи**
Эрик Тан <eric@livepeer.org>
Филипп Ангеле <philipp@livepeer.org>
Джош Оллманн <josh@livepeer.org>

**СТАТУС ДОКУМЕНТА: ПРЕДЛОЖЕНИЕ - по этой ранней версии предложенного решения запрашивается обратная связь.**

## Аннотация #####################################

Предложение под названием Streamflow представляет собой обновления протокола Livepeer и внедряемые вне блокчейна решения, которые позволят Livepeer масштабироваться за пределы ограничений альфа-протокола, развернутого на основе Ethereum. Это предложение описывает обновления, которые касаются доступности, надежности, производительности и масштабируемости сети. Здесь введены такие ключевые элементы как реестр сервисов, механизм согласования заданий без использования блокчейна, новая система платежей, разделение на узлы-оркестраторы и узлы транскодирования, уход от решения проблемы доступности данных с использованием операции проверки без необходимого доверия, а также повышение количества узлов, которые могут конкурировать за выполнение заданий в сети по сравнению с теми низкими пределами, которые были искусственно установлены на период альфа-тестирования. Полученная архитектура позволит пользователям сети выполнять масштабные задания транскодирования с помощью множества одновременно работающих поставщиков, при этом значительно уменьшая влияние волатильности базового блокчейна на экономическую жизнеспособность сети.

## Оглавление ###########################################

* [Введение и справочная информация](#Введение и справочная информация)
* [Предложение протокола Streamflow](#Предложение протокола Streamflow)
    * [Оркестраторы и транскодеры](#Оркестраторы и транскодеры)
    * [Ослабление ограничений транскодера и усиленная защита делегированной доли](#Ослабление ограничений транскодера и усиленная защита делегированной доли)
    * [Реестр сервисов](#Реестр сервисов)
    * [Согласование заданий без использования блокчейна](#Согласование заданий без использования блокчейна)
    * [Вероятностные микроплатежи](#Вероятностные микроплатежи)
    * [Проверка через блокчейн на основе ошибок](#Проверка через блокчейн на основе ошибок)
* [Экономический анализ](#Экономический анализ)
    * [Токен Livepeer](#Токен Livepeer)
    * [Делегирование как сигнал безопасности и репутации](#Делегирование как сигнал безопасности и репутации)
    * [Инфляция в связанном состоянии при апатичных делегаторах](#Инфляция в связанном состоянии при апатичных делегаторах)
    * [Инженерные соображения вне блокчейна](#Инженерные соображения вне блокчейна)
* [Атаки](#Атаки)
    * [Выжимание делегатора](#Выжимание делегатора)
    * [Воровство комиссионных делегатора](#Воровство комиссионных делегатора)
* [Открытые области для исследований](#Открытые области для исследований)
    * [Недетерминированная проверка](#Недетерминированная проверка)
    * [Протоколы публичных транскодерных пулов](#Протоколы публичных транскодерных пулов)
    * [Защита от двойной траты вещателя](#Защита от двойной траты вещателя)
    * [VOD-платежи](#VOD-платежи)
* [Схема миграции](#Схема миграции)
* [Приложение](#Приложение)
    * [Приложение A: Процесс вероятностных микроплатежей](#Процесс вероятностных микроплатежей)
* [Ссылки](#Ссылки)

## Введение и предыстория #################################################

Протокол Livepeer создает и защищает децентрализованную сеть узлов, транскодирующих видео. Пользователи, которые хотели бы транскодировать видео, могут отправить задание в сеть по цене, которую они считают приемлемой, установить связь с назначенным транскодером, выполнить транскодирование видео с экономически обеспеченными гарантиями корректности. В протоколе используется механизм на основе делегирования долей токенов при выборе узлов, которые считаются надежными и эффективными для оперативного и производительного кодирования потокового видео.

Альфа-версия протокола, развернутая в настоящее время в блокчейне Ethereum, реализовала многие задумки, обозначенные в [Livepeer Whitepaper](https://github.com/fedorello/wiki/blob/fedorello-patch-1/WHITEPAPER.md). Система на основе делегирования долей токенов с инфляционным механизмом показала свою эффективность в стимулировании участия и в создании сети из заинтересованных транскодеров и делегаторов, выполняющих соответственно задания по транскодированию и контролю качества. Для некоторых применений, даже на ранней стадии развития, сеть является вполне жизнеспособной и пригодной для использования, например, для продолжительного транскодировании или для прототипирования децентрализованных приложений. Однако для масштабного использования сервисов видео-инфраструктуры, альфа-версия имеет следующие недостатки:

1. Стоимость использования сети слишком зависит от колебаний цен на газ Ethereum, и, следовательно, во время высоких цен на газ или при кодировании, которое требует большого количества транзакций, сеть становится слишком дорогой, чтобы быть жизнеспособной по сравнению с централизованными альтернативами.
1. Распределение заданий на основе ставок и согласование заданий с транскодером с использованием блокчейна создают ненадежные схемы использования для вещателя - если назначенный транскодер переходит в автономный режим, вещатель несет дополнительные расходы и временные задержки при согласовании другого транскодера, что может быть весьма критичным в условиях прямой трансляции.
1. Проблема доступности данных остается нерешенной (в продакшене), и поэтому проверка работы не может быть полностью неинтерактивной и лишенной необходимости доверять.
1. Транскодеры не имеют возможности управлять своей готовностью выполнять задания в зависимости от своей мощности и текущей рабочей нагрузки.
1. Хотя сеть поощряет ценовую конкуренцию, она непосредственно не поощряет конкуренцию за производительность и ответственность.
1. Текущие ограничения для газа Ethereum и практическая реализация протокола ограничивают количество активных транскодеров, которые одновременно могут быть активны, до очень низкого числа, создавая высокий барьер для входа, если узел желает получить возможность конкурировать за работу в сети.

В нижеследующей части этого документа предлагаются решения, которые устраняют каждую из этих проблем по очереди. Начинается все с описания предложений по изменению архитектуры и протокола. Затем, перед рассмотрением возможных атак, анализируются экономические последствия предлагаемых изменений. Далее следует описание открытых областей для исследования, ответы на которые могут способствовать переходу этих предложений от экономической и социальной/репутационной системе безопасности, к надежной криптографической системе безопасности. И наконец, все завершится определенными идеями о переходе от альфа-протокола к Streamflow в действующей сети, если сообщество пожелает принять эти изменения.

В этом документе описываются концептуальные изменения протокола и анализируется их влияние, но конкретные спецификации для их реализации выносятся в сопроводительный документ SPEC, который должен быть представлен в рамках LIP-процесса по улучшению протокола (Livepeer Improvement Proposal).

_Примечание: Чтобы правильно воспринимать предлагаемые обновления протокола, важно иметь представление о том, как работает текущий протокол Livepeer. Это описание можно найти в официальном Whitepaper [[1](#Ссылки)]._

## Предложение протокола Streamflow ########################################

Это предложение вводит ряд изменений и новых концепций в экосистему Livepeer. Каждое из них оказывает влияние на одно или несколько свойств доступности, производительности, надежности или масштабируемости. Они включают:

* Добавление новой роли оркестратора (Orchestrator) к существующим ролям вещателей (Broadcaster) и транскодеров (Transcoder).
* Снижение ограничений на количество транскодеров, позволяющее оркестраторам, которые владеют небольшими долями токенов и отвечают минимальным требованиям к безопасности, более свободно конкурировать за работу в сети.
* Реестр сервисов, в котором оркестраторы предлагают свои мощности и сервисы.
* Переговоры о цене и назначении работ между вещателями и оркестраторами без использования блокчейна.
* Расчеты с использованием вероятностных микроплатежей с залоговыми депозитами на блокчейне.
* Обновленный процесс проверки, в котором проверка с использованием блокчейна должна происходить только в случае уже обнаруженного нарушения.

### Оркестраторы и транскодеры

В настоящее время транскодер в сети Livepeer является узлом, поддерживающим протокол, который одновременно и наблюдает, взаимодействуя с блокчейном, и выполняет работу по транскодированию видео. Короче говоря, он как управляет работой в сети, так и транскодирует видео. Это может создать проблемы с производительностью и надежностью, а также затруднить масштабирование функционирования узлов. Streamflow предлагает двухуровневую архитектуру, которая содержит разделение между:

* Оркестратором (Orchestrator), который знаком с алгоритмом работы протокола, ведет переговоры о работе с вещателями, отвечает за доставку проверенных транскодированных сегментов вещателям и координирует выполнение этой работы среди потенциально большого пула транскодеров.
* Транскодер (Transcoder), который не обязательно знает о Livepeer протоколе с иcпользованием долей и блокчейна, но представляет собой конкурентоспособное, экономически эффективное оборудование, которое выполняет единственную задачу в гонках - как можно дешевле и быстрее транскодировать видео, оставляя задачу координации оркестраторам.

<img src = "https://monosnap.com/image/ZGMX3mqUh21YTJ2G5zho7g761zty7r" alt = "Разделение транскодеров и оркестраторов" style = "width: 750px">

Первый уровень этой архитектуры аналогичен текущему протоколу Livepeer, в котором транскодеры переименованы в оркестраторы. Эти оркестраторы выделяют долю LPT, чтобы обеспечить гарантийные депозиты для работы, которую они выполняют, так что, если они повредят сети, они понесут экономические потери. Вещатели знают об этих оркестраторах, договариваются с ними о выполнении заданий и получают от них транскодированные сегменты с возможностью использовать процедуру сокращения доли оркестраторов, если они выполнят свою работу недобросовестно.

Второй уровень этой архитектуры - это новая концепция, которая называется транскодирующий пул. Работа по быстрому и дешевому выполнению транскодирования видео может быть выполнена графическими процессорами, обладающими необходимой мощностью (описаны в Video Miner Proposal [[2](#Ссылки)]), в которых бездействует NVENC. Это оборудование должно быть конкурентоспособным для выполнения работы по кодированию, а конкурентные силы и экономическая система должны привести к значительно более дешевым ценам, чем если бы сами оркестраторы выполняли бы эту работу с теми же настройками CPU и необходимостью при этом обслуживать блокчейн и протокол сети.

Это аналогично существующим пулам для майнинга криптовалют, в которых реализация для самих пулов может быть централизованной или децентрализованной. Пул может выполнять майнинг своими силами (индивидуальный пул), или он может быть открыт для миллионов компьютеров со всего мира (публичный пул), соревнующихся за добычу очередного блока. Оркестратор при желании может предоставлять функцию транскодирования своему собственному пулу, что приведет к той же самой ситуации, которая существует в протоколе Livepeer сегодня. Однако, если он сделает так, то ему придется быть экспертом в двух очень разных видах деятельности и конкурировать с теми оркестраторами, которые открывают свои пулы для потенциально более быстрых или более дешевых источников транскодирования. С другой стороны, если оркестратор запускает свой собственный пул, он может доверять результатам кодирования видео, больше не проверяя работу ненадежных транскодеров.

Некоторые преимущества этой двухуровневой системы:

* Любой, кто захочет заработать комиссионные, сможет сделать это, просто включив свое оборудование и настроив его на выполнение доступных заданий по транскодированию. Нет необходимости знать что-либо о работе блокчейна, криптовалюте, долях и депозитах. Это очень похоже на то, как каждый может заработать биткойн благодаря майнингу при помощи пула. Тем не менее, несмотря на то, что доступ открыт для всех желающих, транскодеры с преимуществами в области электроэнергии, пропускной способности и расположения, скорее всего, получат преимущество.
* Вещатели получат безопасность, основанную на делегированной пулу оркестратора доле токенов, однако конкретные масштабируемые реализации, обеспечивающие безопасность публичных и индивидуальных пулов можно оставить для экспериментов за пределами протокола Livepeer.
* Оркестраторы смогут сосредоточиться на правильности взаимодействий в рамках протокола и на безопасности, а не на масштабировании оборудования. Один оркестратор может одновременно управлять сотнями видеопотоков без необходимости транскодирования самого видео.
* Могут быть доступны альтернативные реализации пула транскодеров, использующие графические процессоры, настройки для работы с заданиями в разных регионах, поощряющие конкуренцию, что в итоге приведет к наиболее низким ценам для вещателей.

В этом документе будет описан протокол для организации коммуникации и безопасного взаимодействия между вещателем и оркестратором, второй же уровень протокола (между оркестратором и транскодером) может быть реализован по-разному. В простейшем случае, когда оркестратор является пулом для своего собственного транскодера (индивидуальный пул), безопасность протокола обеспечивается автоматически, в то время как в альтернативных реализациях пулов для координации могут быть достигнуты определенные компромиссы между доверием и производительностью, начиная от централизованного и доверенного, заканчивая децентрализованным, находящимся под защитой долей и депозитов с применением блокчейна. Предполагается, что поскольку проверка заданий, выполненных случайными участниками публичного пула, сопряжена с дополнительными затратами для оркестратора, индивидуальные пулы могут превзойти публичные, однако это может быть теоретически преодолено за счет надежных криптоэкономических депозитов, сокращений и протоколов проверки.

### Ослабление ограничений транскодера и усиленная защита делегированной доли

Второе важное изменение, предлагаемое Streamflow, - это ослабление искусственного ограничения на количество активных транскодеров (оркестраторов в Streamflow). При генезисе этот параметр был установлен в 10, затем увеличился до 15, однако это все еще создает серьезный барьер для входа, так как узлу требуется все больше делегированных токенов LPT для попадания в активный пул. В Streamflow цель состоит в том, чтобы устранить это искусственное ограничение и разрешить любому узлу, который обеспечивает достаточную безопасность в виде доступа к доле (или делегированной доли), конкурировать за выполнение заданий в сети.

Главные причины ограничения были следующими:

* Было важно, чтобы активные транскодеры, получившие задания при помощи блокчейна, были онлайн и доступны для выполнения работы. Ограничение их количества, а также простота просмотра их статистики и производительности помогли обеспечить высокое качество сети.
* Ограничения на использование газа Ethereum в расчетах, касающихся группы активных оркестраторов, создали искусственное ограничение, которое так или иначе можно преодолеть, но не на существенную величину.
* Во время альфа-тестирования было важно находится в тесном контакте и осуществлять координацию с группой активных транскодеров, чтобы они могли часто обновлять программное обеспечение, реагировать на ошибки и помогать в разработке и обеспечении качества сети.
* Активным транскодерам нужно было предоставить достаточно большие доли токенов, которыми они рискуют, чтобы обезопасить сеть, так что, если они обманут, они получат существенное экономическое наказание.

Эффекты от снижения указанного искусственного ограничения будут реализованы следующим образом:

* Согласование заданий без использования блокчейна - оркестраторы, которые недоступны или не выполняют работу, просто потеряют возможность брать последующие задания, но никак не испортят пользовательский опыт вещателей.
* Набор активных транскодеров не нужно рассчитывать каждый раунд, вместо этого его можно поддерживать на месте (у оркестратора), в то время как оркестраторы производят операции связывания, отвязывания или получают сокращения.
* Активные, конкурентоспособные оркестраторы все равно захотят уделить пристальное внимание обновлениям, багам и развитию сети, а неактивные, не желающие участвовать в развитии сети, просто не смогут получить задания, не причиняя при этом вреда вещателям.
* Теперь, когда большой процент первоначальной доли токенов активно задействован в работе сети, требования могут быть установлены таким образом, чтобы в игре было достаточно и доли, и безопасности для обеспечения большего количества узлов, конкурирующих за работу в сети.

Точное количество целевых оркестраторов и метод их реализации по-прежнему остается открытым для исследования вопросом. Тем не менее, первоначально, должно быть увеличение на порядок - например, 100 активных оркестраторов, а не 15 - с целью в конечном итоге увеличить их число до 1000, чтобы иметь возможность предложить с избыточностью любой сервис в любом регионе мира. Вот несколько рассматриваемых механизмов с кратким описанием некоторых из компромиссов:

1. **Увеличение числа N (количество слотов для оркестраторов) с 15 до чего-нибудь гораздо большего, например, 200**: Все по сути будет работать так же, как сегодня, с гораздо более низким барьером для активации узла. Но это сделало бы операции по связыванию токенов более дорогими. Масштабирование Ethereum и вопросы, касающиеся газа, могут сильно изменить ситуацию.
2. **Установка минимальной требуемой доли токенов, для того чтобы стать оркестратором**: Это установит максимально возможное `N`, позволяя точно знать, что требуется для достижения критериев безопасности и возможности оставаться в активной группе. Это также позволило бы расширять сеть оркестраторов по мере выпуска новых токенов LPT и стимулировать делегаторов активно искать новых потенциальных оркестраторов, стремящихся выполнить минимальные требования и стать активными, чтобы конкурировать за работу.
3. **Установка фиксированного количества доли токенов для каждого оркестратора**: Это вынудит оркестраторов запускать дополнительные узлы, а делегаторов - постоянно передвигать свою долю инфляционных LPT токенов. Но у этого решения есть некоторые слабые стороны как для оркестраторов, так и для делегаторов, возникающие в результате взаимодействия с пользователем, а также некоторые сложности, касающиеся реализации.
4. **Исключение из протокола всех требований к минимальной доле и реализация возможности для клиентов настраивать размер доли, необходимый для защиты работы**. Это дает максимально открытый доступ и изначально является наиболее децентрализованным решением, однако при создании высококачественной сети обеспечивает наименьшую координацию между делегаторами, владеющими токенами, и оркестраторами, ведь по сути дела, репутация здесь играет более важную роль, и, следовательно, в долгосрочной перспективе это может привести к большей централизации при назначении выполняемых заданий, поскольку у делегаторов будет меньшая суммарная возможность влиять на распределение заданий.

Несмотря на то, что рассматриваются преимущества и недостатки вышеупомянутых подходов, важно отметить, что результатом, достигнутым при реализации любого из вышеперечисленных решений, будет расширение сети оркестраторов, увеличение конкуренции и отказов в интересах вещателей, а также постоянные стимулы для делегирования своей доли узлам, способным надежно и экономически эффективно предоставлять дополнительные платные сервисы.

Одним из преимуществ модели с минимальной долей является то, что по мере того, как комиссионные двигаются по сети, нет особых причин поддерживать узел, который не конкурирует за работу в сети. Количество слотов ограничено, и эту долю лучше использовать для делегирования узлу, который способен поделиться комиссионными, чем просто сидеть на не работающем узле, получая лишь вновь выпускаемые (инфляционные) токены.

### Реестр сервисов

Streamflow расширяет роль реестра сервисов (Service Registry) в блокчейне. Оркестраторы будут продолжать объявлять свои `rewardCut`, `feeShare` и информацию о качестве соединения, однако они также будут рассказывать об услугах, которые предлагает их узел, и о регионах, которые они обслуживают. Это сильно повысит производительность, и вещатели смогут искать необходимые им услуги, предоставляемые ближайшим узлом. Оркестраторы больше не будут называть цену, которую они берут за работу, так как переговоры о цене и свободных мощностях выносятся за пределы блокчейна. Что касается рассматриваемых услуг, тут возможны два варианта:

1. **Сервис**
    1. Идентификатор сервиса - идентификатор, который представляет некоторую услугу, такую ​​как “CPUTranscoding”, “GPUTranscoding” или “SegmentVerification”. Над точным определением здесь еще предстоит поработать, и, возможно, сервисы будут более конкретизированными, такими, как кодирование ввода/вывода, например “H264 1080p -> 720p”.
    1. Функция проверки - адресный указатель на функцию проверки, которая будет запускаться для проверки корректности этого сервиса с использованием блокчейна (может быть равна null, если проверка недоступна).
1. **Расположение**
    1. Реализация - это TBD, но это, возможно, абстракция, которая определяет массив регионов, которые этот узел желает или способен обслуживать.
	
Благодаря предоставляемой узлами информации, у вещателей будет возможность фильтровать реестр сервисов, чтобы найти узлы с необходимыми услугами в подходящем регионе, чтобы начать переговоры с подходящими поставщиками услуг. В альфа-версии протокола Livepeer местоположение не бралось в расчет, однако для приема видео в реальном времени может быть критически важным, чтобы узлы, принимающие видео, были расположены в непосредственной близости от источника вследствие различных возможных сетевых проблем, которые могут создавать нестабильность в течение продолжительных сеансов связи.

Объявленное местоположение, конечно, может быть сфальсифицировано, однако, как и многие аспекты Streamflow, клиентские приложения быстро обнаружат и отфильтруют плохо функционирующих оркестраторов, что лишит их возможности выполнять последующую работу и получать комиссионные. Честно работающие узлы, нацеленные на успешные отношения с вещателями, комиссионные и репутационную статистику, вероятно, будут предоставлять полезную информацию о местоположении узла, которая приведет к успешному согласованию, назначению и устойчивому потоку заданий.

Поскольку узлы получают инфляционный LPT, для оптимального использования они могут добавить новый узел в реестр сервисов, который предоставляет услуги или местоположения, на которые есть спрос, но нет достаточно надежного или экономически выгодного предложения, расширяя таким образом зону обслуживания сети и способность обслуживать различных клиентов с различными нуждами. 

### Согласование заданий без использования блокчейна

Переход от согласования заданий с помощью блокчейна к согласованию без его использования является, пожалуй, самым большим изменением, предлагаемым Streamflow. Это меняет утверждение о том, что задания распределяются строго в соответствии с долями (это будет рассмотрено ниже в разделе, посвященным анализу), однако это создает огромные преимущества. А именно:

* **Доступность** - вещатели смогут убедиться, что оркестраторы готовы выполнять работу, прежде чем заключать с ними контракт.
* **Резервирование** - если оркестратор недоступен до или во время работы, можно будет просто переключиться на другой оркестратор. Или можно будет начать работать с несколькими оркестраторами.
* **Скорость** - Можно будет начинать без каких-либо задержек. Не будет необходимости ждать подтверждения от блокчейна.
* **Экономическая выгода** - Не будет затрат на транзакции в блокчейне или на оплату газа, связанную с отправляемыми по сети запросами.

Для проведения переговоров вещатель будет действовать в соответствии со следующим протоколом:

1. Просмотрит реестр сервисов и обнаружит все доступные оркестраторы, соответствующие запрашиваемым параметрам обслуживания и местоположения, с минимальной требуемой долей.
1. Затем он будет использовать предоставленную информацию о соединении, чтобы пропинговать каждого из них запросом на работу.
    1. Запрос на работу содержит запрошенную услугу и запрошенное местоположение (необязательно).
1. Оркестраторы как можно скорее отвечают ценовым предложением на выполнение этой работы, если они желают конкурировать за это задание.
    1. Оркестраторы также включают параметры вероятностных микроплатежей (PM) в свое ценовое предложение (описано ниже).
1. Вещатель собирает данные ответа, а также время ответа от оркестраторов.
1. Чтобы выбрать, с каким оркестратором(ами) работать, вещатель использует собственный внутренний алгоритм, учитывающий предпочтения в отношении времени отклика, цены, истории прошлых работ, параметров PM, требований к резервированию и к безопасности в виде доли.
1. Вещатель начинает отправлять видеофрагменты и PM-билеты выбранному оркестратору.
1. Оркестратор проверяет в блокчейне наличие у вещателя PM-депозита, и, если уровень депозита достаточен, он выполняет работу, отправляя закодированный сегмент обратно к вещателю.

Очевидно, что шаг 5 в этом протоколе можно реализовать очень по-разному. Суть в том, что вещатели могут выбирать своих собственных оркестраторов, и им не нужно взаимодействовать с блокчейном, чтобы предложить свое задание или назначить его.

Вещатели могут работать со своим собственным оркестратором, если захотят, а к другому обращаться только когда они достигнут предела собственной вычислительной мощности. Они могут работать с одним и тем же узлом (с которым есть давние доверительные отношения), и переключаться на другой, только когда их узел выходит из строя или становится недоступным. Они могут начать с 5-кратного избыточного кодирования с использованием CPU для очень важного потокового вещания премиум-класса, или они могут использовать самое дешевое из возможных в мире вариантов кодирования при помощи GPU, соглашаясь при этом на очень низкую надежность для запрашиваемого задания, чтобы сэкономить.

<img src = "https://monosnap.com/image/D7D2hmD9iJmBvjJXHRTYPZ8nLL7BGA" alt = "Согласование заданий без использования блокчейна" style = "width: 750px">

Переключение и добавление избыточности для вещателя не влечет за собой никаких накладных расходов на транзакции в блокчейне, тогда как в альфа-версии протокола для такого переключения требуется дополнительная транзакция в блокчейне и 15-30 дополнительных секунд для ее подтверждения.

Обратите внимание, что шаги 1-4 могут при желании выполняться в фоновом режиме на текущей основе, а не при старте потока. Если вещатель обрабатывает много одновременных потоков, он может посчитать целесообразным сохранять актуальную таблицу цен на услуги для всех доступных оркестраторов, чтобы он затем смог в любой момент начать работать с любым из них.

### Вероятностные микроплатежи

Наибольшее влияние на экономию средств от Streamflow окажет предложение по вероятностным микроплатежам (Probabilistic Micropayments, PM). Ранее для разблокирования платежей за выполненную работу протокол использовал поток транзакций deposit() -> job() -> claim() -> verify() -> distributeFees(). Последние три из этих транзакций должны были быть выполнены в среднем на каждые 1000 сегментов видео (или больше), а выполнение пяти транзакций для небольшого объема работы было бы совершенно непосильным для транскодеров.

Для получения справочной информации о PM можно посмотреть пост от команды Orchid Protocol о его использовании в децентрализованной сети VPN, а также о предыдущих научных исследованиях [[3, 4, 5](#Ссылки)]. Суть в том, что вещатель выпускает подписанные PM-билеты вместе с каждым сегментом работы для оркестратора. PM-билет имеет высокую номинальную стоимость, если он “выигрывает”, что позволяет оркестратору обналичить его через блокчейн. Однако вероятность его выигрыша очень мала, поэтому ожидаемая стоимость каждого билета - это цена/сегмент, о которой договорились вещатель и оркестратор. В долгосрочной перспективе вещатели будут платить почти в точности то, что они согласовали с оркестратором, а оркестратору будет выплачиваться более-менее точная сумма за выполненную работу.

При использовании PM стоимость сбора платежей может быть стоимостью одной простой транзакции, а собранная сумма платежа может быть эффективно сгруппирована в любую сумму, которую оркестратор желает получить. Например, оркестратор всегда может получить выплаты ETH на сумму 10$, тогда как стоимость обналичивания билета из-за цен на газ может составлять 0,10$ (накладные расходы 1%). Если цены на газ возрастут в 10 раз, оркестратор может вместо этого обналичить платежи в размере 100$, сохраняя тот же 1% накладных расходов, или он может при желании еще сильнее уменьшить накладные расходы на получение вознаграждения, если он хочет быть более конкурентоспособным. В соответствии с философией, лежащей в основе многих обновлений из Streamflow, эти платежи будут адаптироваться к рынку и клиентам, вместо жесткой фиксации параметров в самом протоколе.

Способность вещателя оплатить полученные услуги в момент, когда оркестратор обналичивает билет обеспечивается блокчейном, ограниченным по времени депозитом и системой штрафов.

Из-за системы согласования работы без использования блокчейна и потенциальной избыточности кодирования, которая может потребоваться вещателю, он может отправлять PM-билеты сразу нескольким оркестраторам, запускать и останавливать работу с любым оркестратором в любой момент, а оркестратор также может прекратить выполнение работы в любое время, если он обнаружит, что ему платят неправильно или он просто хочет отключиться. Это значительно меняет ментальную модель с “задания” в Livepeer, которое является непрерывным потоком сегментов, на работу, представляющую собой отдельный сегмент видео вместе с одним PM-билетом.

Полный рабочий PM процесс оставлен для [приложения](#Приложение), поскольку он затрагивает вопросы проверки, согласования без блокчейна и многие другие вещи, такие, например, как риск двойных расходов.

### Проверка через блокчейн на основе ошибок

Последнее существенное изменение, предлагаемое Streamflow, заключается в корректировке протоколов проверки, что позволяет снизить затраты и избежать проблем с доступом к данным. Предыдущие транскодеры должны были вызывать проверку Truebit для 1 из `VerificationRate` сегментов, который изначально был установлен в 1 из 1000 сегментов. Это очень дорого и при этом требовалось независимо от того, правильно или неправильно работал транскодер. Новое предложение заключается в том, что:

* Вещатели несут ответственность за проверку полученных транскодированных сегментов и через блокчейн Truebit'а вызывают их только, если они считают, что сегмент не прошел проверку (кодирован неправильно).
* Если Truebit (или другая соответствующая функция блокчейн-проверки) соглашается с вещателем, то доля оркестратора сокращается, а вещатель получает значительную награду.

<img src = "https://monosnap.com/image/KY9Vfg4wlcpE7Lv3Wp2aBYlTmIadbC" alt = "Проверка через блокчейн на основе ошибок">

Один из аргументов против этого метода в том, что вещатель не имеет значительных вычислительных ресурсов для перекодирования видео, чтобы проверить, была ли работа выполнена правильно. Однако, вещатель может выбрать 1 из `VerificationRate`. Он может проверить больше сегментов, если ему требуется больше надежности, или он может отдать эту работу по проверке кодированных сегментов другому узлу и оплачивать ее отдельно - эквивалент найма второго оркестратора только для одного из `VerificationRate` сегментов. В таком случае можно использовать дешевый оркестратор для основной работы. Существуют также более дешевые проверки, которые могут быть получены с помощью анализа кадров выходного видео, вместо полного перекодирования сегмента. Эти дешевые методы проверки могут быть использованы для первичного обнаружения ошибок, а в случае подозрения можно делать перекодировку и отправлять результат на проверку в Truebit.

Ключевым моментом, однако, является то, что оркестратор не знает, какие сегменты будут проверяться, и если какие-либо сегменты не пройдут проверку, он потеряет значительную часть своей LPT доли. Маловероятно, что выгода от мошенничества превысит стоимость сильно сокращенной доли. Кроме того, поскольку вещатель может использовать избыточное кодирование, если он обнаружит несогласованность или возникнут подозрения в мошенничестве в результате применения дешевой операции проверки (без повторного кодирования), он может просто выбрать другого оркестратора для этого сегмента, чтобы получить правильную кодировку и вставить его в свой плейлист.

Одним из последствий такого подхода является то, что не нужно платить платформе Truebit, за исключением случаев очевидного мошенничества, а, следовательно, почти никогда, так как оркестратору экономически не выгодно обманывать преднамеренно. Это делает сеть намного более дешевой в использовании, чем когда происходят вызовы Truebit для каждого из `VerificationRate` сегментов.

## Экономический анализ #################################

Изменения, предложенные Streamflow, приводят к несколько иным стимулам и поведению как для оркестраторов, так и для делегаторов, что приводит к созданию более масштабируемой, надежной и экономически эффективной сети. В этом разделе начинается анализ экономического воздействия предлагаемых изменений, в том числе анализ роли Livepeer токена, роли делегирования, влияния инфляции на сеть, а также некоторые другие экономические соображения.

### Токен Livepeer

Токен Livepeer (LPT) всегда можно описать как рабочий токен. Те, кто использовал его в качестве доли (stake), имеет возможность выполнять работу в сети и, следовательно, получать комиссионные (в ETH) за выполнение указанной работы. Раньше поток заданий маршрутизировался пропорционально ставке, если цены, предлагаемые всеми узлами, не менялись. С самого начала были задуманы механизмы для “запроса задания”, заключающиеся в том, что если узел не выполнял достаточного количества работы в пределах некоторого порогового значения, пропорционального своей доле, то его можно было сокращать. Это было попыткой гарантировать, что узлы действительно будут приносить ценность (или нести накладные расходы за то, что они этого не делают или лишь имитируют деятельность), а не просто сидеть сложа руки и накапливать инфляцию (вновь выпускаемые LPT токены). Кроме того, не было требования, чтобы задания по кодированию выполнялись экономически эффективно или качественно. Конкуренция могла поощряться социально, но не требоваться на уровне протокола.

На первый взгляд, обновления протокола для уменьшения искусственного ограничения на количество оркестраторов и для согласования заданий без использования блокчейна изменяют прямую связь между токеном и правом выполнять работу, однако при дальнейшем анализе видно, что достигается то же самое состояние равновесия. Давайте посмотрим на функцию, которую держатель токена пытается максимизировать:

`Стоимость, начисленная за один раунд = инфляционный LPT + заработанные комиссионные`.

Инфляционный LPT является предсказуемым, так как основывается на `rewardCut` оркестратора. Делегатор может точно определить, сколько LPT он хочет получать в обмен на выполняемую им работу по обеспечению контроля качества.

С другой стороны, владелец токена в значительно меньшей степени контролирует зарабатываемые комиссионные. Потому что это зависит от:

1. Количества работы, которую выполняет его оркестратор
2. `feeShare` оркестратора
3. Общей суммарной доли токенов, делегированных оркестратору (на какой процент от получаемых комиссионных он имеет право)

По завершении раунда делегатор сможет рассчитать доходность своей доли LPT. Вот этот коэффициент:

`ETH комиссионных / один делегированный LPT`

Это будет видимая статистика, которую делегаторы смогут использовать для сравнения оркестраторов друг с другом, и, как и ожидалось, делегирование будет изменяться от раунда к раунду в сторону узлов, где есть возможность максимизировать это соотношение. Короче говоря, зачем привязываться к узлу, который дает 1 gwei / LPT, когда есть другой узел, который дает 2 gwei / LPT?

<img src="https://monosnap.com/image/gl3GWGxwRVkGGsQ2wkkz7ActBLlkRQ" alt="Уровень комиссионных">

Но при этом стоит отметить, что при увеличении суммарной делегированной доли этого лучшего с точки зрения вышеуказанного соотношения узла, комиссионные будут распределены между большим количеством делегированных токенов, и уровень комиссионных упадет. Состояние равновесия заключается в том, что узлы, выполняющие больше работы (и больше зарабатывающие), имеют большую долю, а узлы, выполняющие меньше работы с теми же ценами на работу, имеют меньшую долю токенов. По сути, все конкурирующие узлы должны в конечном итоге иметь одинаковые сбалансированные цены на работу, а разумно делегированная доля токенов будет приносить делегатору сбалансированную прибыль - и, следовательно, разумно использованные токены LPT дают доступ к выполнению работы и возможность получить комиссионные независимо от того, как назначаются задания.

### Делегирование как сигнал безопасности и репутации

Негативный результат, который люди могут предвидеть, состоит в том, что узлы, которые получают много работы, могут установить 0%-ую долю комиссионного вознаграждения и, следовательно, не быть привлекательными для делегирования. Это нормально - они используют оборудование и несут расходы, а также оказывают отличную услугу сети - им может не потребоваться делегирование. Но делегирование, с другой стороны, обеспечивает дополнительную безопасность - чем больше токенов может попасть под сокращение, если узел будет обманывать, тем больше репутационный сигнал. Клиенты используют этот сигнал для выбора узлов для работы, и поэтому конкурирующий узел, заявляющий долю вознаграждения > 0%, с большей вероятностью будет привлекать делегаторов и, следовательно, работать до тех пор, пока сможет выполнять работу лучше или дешевле, чем узел с 0% комиссионным вознаграждением. Это также способствует гибким настройкам и увеличению количества вариантов использования сети. Это расширяет возможности для конкуренции, децентрализации, разнообразия и устойчивости сети.

Поскольку новые узлы стремятся конкурировать за работу в сети, им, возможно, потребуется привлечь достаточно делегированных LPT токенов, чтобы обеспечить безопасность, необходимую для вещателей. В этих случаях вполне вероятно, что эти узлы будут устанавливать большое комиссионное вознаграждение. Активные делегаторы получат возможность искать и делегировать свои токены узлам, которые выигрывают большие части работ, с более высокой ставкой комиссионных, что приведет к более высокому уровню комиссионных. Короче говоря, делегированные токены могут обеспечивать безопасность и маршрутизацию работы в обмен на выплачиваемую часть комиссионных, когда работа выполнена хорошо. Активное делегирование может привести к тому, что более оппортунистические узлы смогут расширить конкурентные возможности сети.

### Инфляция в связанном состоянии при апатичных делегаторах

Одно из критических замечаний в отношении модели без минимальных ставок заключается в том, что она допускает ленивое поведение делегаторов. Инфляционный LPT продолжает накапливаться в связанном состоянии и позволяет делегатору действовать в стиле "поставил и забыл", просто собирая LPT и никак не улучшая качество сети.

Это может иметь место в самые первые дни существования сети, до того как комиссионные сборы в ETH послужат дополнительным стимулом для делегаторов действовать, однако маловероятно, что это даст максимальный результат, когда оркестраторы соревнуются за работу и комиссионные. На этом этапе поведение в стиле автопилота все еще может привести к накоплению LPT, но при этом приведет к пропуску потенциальных комиссионных, которые можно было бы заработать, переключившись на оркестраторов, которые дают более высокое соотношение ETH / делегированный LPT.

Поскольку при масштабном использовании уровень инфляции, вероятно, уменьшится, когда держатели токенов делегируют свои токены, чтобы конкурировать и зарабатывать комиссионные, вознаграждение от инфляционных LPT также будет уменьшаться, и значительная часть вознаграждения начнет поступать именно от комиссионных. И, как указано выше в разделе про токен LPT, необходимость постоянной проверки качества сети и маршрутизации работы к наилучшим узлам финансово мотивирована. В итоге, апатичный делегатор вознаграждается меньше, чем активный делегатор.

Кроме того, поскольку оркестраторы, которым когда-то требовалось привлечь токены от делегаторов для достижения минимальной ставки, могут накопить достаточно средств для обеспечения безопасности своего собственного узла, они могут уменьшить долю комиссионного вознаграждения. На этом этапе делегатору, стремящемуся к оптимальному использованию своих токенов, лучше всего найти новый перспективный узел, такой, который может расширить зону обслуживания сети и который может предложить более высокую долю комиссионного вознаграждения для привлечения делегированных токенов. Именно этот постоянный контроль качества, выполняемый оптимизирующим делегатором, и компромисс между ставкой и вознаграждением создаст постоянную конкуренцию и будет способствовать дальнейшей децентрализации сети.

### Инженерные соображения вне блокчейна

Как упоминалось ранее, один из аспектов философии Streamflow - перенести решения о допустимых значениях параметров и p2p-взаимодействий за пределы основного протокола, в реализацию и настройки клиентского приложения. Многочисленные реализации и настройки этих параметров приведут к созданию надежной сети, устойчивой к атакам и злоумышленникам. Однако, если сам протокол возьмет на себя меньше решений, многое будет зависеть от реализации клиента. Вот некоторые из основных инженерных соображений, которые необходимо воплотить в жизнь, чтобы Streamflow из коробки работал действительно эффективно:

* Политики управления рисками PM - когда оркестратор должен работать с вещателем или не работать с ним, основываясь на репутации и истории, и наоборот.
* Безопасная генерация случайных чисел для протокола PM.
* DDoS-сопротивляемость для оркестраторов.
* Алгоритмы ибыточности и отработки отказов для вещателей при различных сценариях и вариантах использования.
* Стратегия определения цены для вещателей.
* Потоковые протоколы с низкой задержкой и проверка подписи/оплаты, когда последний сегмент недоступен к моменту начала работы.

Каждый из вышеперечисленных аспектов может повлиять на эффективность сети с точки зрения вещателя - и, следовательно, необходимую избыточность и, в конечном итоге, затраты. Хорошей новостью является то, что большая часть вышеперечисленного может быть реализована с помощью стратегий без использования блокчейна, и с этим можно постоянно экспериментировать, используя различные конкурирующие между собой реализации и конфигурации. Сеть, в которой есть агенты, действующие по-разному и непредсказуемо, сложнее оптимизировать для злоумышленника, который обычно хочет иметь дело с одной единственной реализацией. 

## Атаки ###############################
Некоторые из конкретных подпротоколов, таких как проверка на основе PM и Truebit, могут подвергаться своим собственным атакам, которые мы оставляем для анализа в соответствующих областях исследований. Вот несколько кратких обзоров потенциальных атак и контрмер в рамках новой экономики протокола Streamflow.

### Выжимание делегатора

Когда кандидат в оркестраторы хочет запустить свой узел чтобы предлагать свою кандидатуру для работы, ему может потребоваться привлечь делегирование для достижения указанной клиентом минимальной суммы ставки. Для этого он может выставить привлекательные `RewardCut` и `FeeShare`. Однако, когда его узел начнет выполнять работу, и он начнет зарабатывать инфляционные LPT, в какой-то момент он может захотеть поставить полученные LPT на свой узел, чтобы таким образом уменьшить количество инфляционных LPT и комиссионных сборов, которые он должен отдавать своим делегаторам. Для этого он может избавиться от нынешних делегаторов, изменив параметры `RewardCut` и `FeeShare` так, что они станут непривлекательными для них, а затем заполнить образовавшийся пробел своей собственной долей LPT токенов.

Теоретически это приемлемо, так как делегаторы могут переходить к более привлекательным узлам и подстраиваться под изменения. К сожалению, это создает раздражающий UX (пользовательский опыт), в котором делегаторы должны быть постоянно начеку и проявлять активность, чтобы получать максимум выгоды.

### Воровство комиссионных делегатора

Как уже было сказано в разлеле про выжимание делегатора, у оркестратора есть возможность избавиться от своих делегаторов. Это может стать особенно вредоносной техникой, если оркестратор также удерживает свои выигрышные PM-билеты до момента, когда делегаторы уходят, а затем обналичивает их, когда на его узле только его доля LPT токенов. То есть комиссионные сборы и LPT вознаграждения, на которые делегаторы имеют право, будут переданы оркестратору.

Этому можно противодействовать, если на PM-билете есть дата истечения срока действия, и она более ранняя, чем дата разблокирования депозита вещателя. Таким образом, билеты должны быть обналичены в короткие сроки и потенциально могут содержать фиксированную долю гонорара оркестратора, чтобы при обналичивании выигрышного билета было сделано правильное разделение вознаграждения между делегаторами и оркестратором.

## Открытые области для исследований ############################

Как и во всех работах на ранней стадии существования криптоэкономических блокчейн-протоколов, существует множество исследовательских проблем, которые необходимо решить, прежде чем создаваемые системы смогут достичь полной децентрализации, доверия и экономической эффективности. Вот пара областей, в которых проект активно проводит исследования. Активное участие членов сообщества для продвижении в этих областях очень приветствуется.

### Недетерминированная проверка

Продолжается исследовательская работа, чтобы проверить вероятность того, что кодированный с помощью GPU сегмент представляет собой то же самое, что и предварительно кодированный (pre-encoded) сегмент. Эксперименты показали, что вероятностный и основанный на метриках подход дает довольно точные результаты, однако пригодность этого метода для фактического сокращения депозитов на основе вероятностней довольно спорная вещь и поэтому здесь требуются дальнейшие исследования.

С другой стороны, детерминированное кодирование может по-прежнему проверяться различными способами верификации, включая Truebit, аппаратную верификацию на основе SGX, через Oracle или даже через доверенные верификаторы.

### Протоколы публичных транскодерных пулов

Разделение между обязанностями оркестратора и транскодера должно помочь значительно масштабировать операции на Livepeer узлах, используя незанятые аппаратные средства для транскодирования видео, не обязательно требуя, чтобы все эти узлы работали в сети Livepeer 24/7. Скорее всего индивидуальные пулы, в которых оркестратор является также и владельцем оборудования для транскодирования, будут наиболее эффективными с точки зрения затрат, поскольку оркуестратор может полностью доверять результату работы своих транскодеров.

Публичные пулы, в которых оркестратор не доверяет транскодерам, но может позволить кому-либо участвовать в гонке транскодирования сегментов могут быть очень эффективными,  используя любое простаивающее оборудование и позволяя таким образом оркестратору работать без необходимости поддерживать отдельную инфраструктуру. Однако, поскольку эти удаленные узлы транскодирования не являются доверенными, оркестратор должен будет проверить их работу, так как иначе он рискует попасть под сокращение своей доли токенов. Такой подход сопряжен с дополнительными затратами и, следовательно, вряд ли сможет конкурировать с индивидуальными пулами, если только не будут созданы экономические протоколы для защиты этих публичных пулов в форме размещения депозитов. Если можно будет доказать, что причиной сокращения был какой-то конкретный неизвестный транскодер, и будет достаточное количество депозита/доли, чтобы покрыть размер сокращения, тогда публичные пулы будут жизнеспособными.

Эта тема открыта для дальнейших исследований и проектирования.

### Защита от двойной траты вещателя

В схеме вероятностных микроплатежей всегда есть шанс того, что с некоторой долей вероятности вещатель случайно выпустит больше выигрышных билетов, чем сможет оплатить со своего баланса. А так как оркестраторы могут вовремя не уведомить вещателя о выигрышном билете, трудно получить точный учет баланса вещателя. Мы продолжаем исследовать необходимые варианты и способы управления депозитами, чтобы избежать случайных двойных трат при различных схемах использования сети. Дополнительную информацию смотрите в приложении о вероятностных микроплатежах.

### VOD-платежи

Одним из приятных моментов, которые вещатели смогут обнаружить, когда дело дойдет до транскодирования видеопотока по требованию (video-on-demand, VOD), является то, что они могут сделать свой контент доступным, запросить задание и отключиться - так что оркестратор сможет выполнять задание асинхронно, распределять его на множество узлов, или запланировать его на момент, когда у него будут свободные ресурсы.

Однако в схеме PM, описанной в Streamflow, вещатель должен быть в сети, чтобы непрерывно отправлять платежи вместе с потоком контента. Часть системы безопасности заключается в признании нормальным того, что оркестратор в любой момент может прекратить выполнять свою работу, а вещатель в этом случае просто перестает отправлять ему платежи.

Тем не менее, для VOD-заданий, если вещатель оплачивает аванс за все сегменты видео, а затем уходит в автономный режим, нет никакой гарантии, что оркестратор выполнит транскодирование или сделает транскодированные сегменты доступными для вещателя. На данный момент VOD-транскодирование возможно, но стиль "загрузил и ушел" не работает. Исследование более эффективных механизмов, позволяющих осуществлять VOD-платежи, продолжается.

## Схема миграции ############################

Предложение Streamflow находится на ранней стадии исследования, проектирования, получения обратной связи и внедрения. Оно, безусловно, заслуживает тщательного обсуждения, тестирования, аудита и принятия сообществом перед запуском в основной сети Ethereum в качестве следующей итерации поверх альфа-протокола Livepeer. Этот раздел призван перечислить некоторые моменты касающиеся миграции на новый протокол:

* В смарт-контракте Ethereum'а будет развернута новая логика, однако предполагается, что миграция данных будет практически не нужна. Можно использовать существующий в Livepeer механизм обновления через прокси-делегирование.
* Существующее состояние протокола Livepeer, включая баланс долей, комиссионные сборы, вознаграждения, делегирование и т.д. будет сохранено.
* Транскодеры, вещатели, оркестраторы и делегаторы будут обновлять свое клиентское программное обеспечение, которое будет содержать логику для согласования работ, резервирования, оплаты и обновленной процедуры проверки.
* Оркестраторы будут регистрировать любые новые обязательные параметры в реестре сервисов, включая поддерживаемые сервисы и, возможно, местоположения.
* Вещатели установят PM-контракты и депозиты. Существующие депозиты смогут мигрировать из Minter в PM-контракт с помощью действий пользователя, когда это требуется.
* Ожидается, что это может быть достигнуто практически без каких-либо простоев протокола.
* Сторонним клиентам, таким как анализаторы протоколов и аналитические инструменты, вероятно, потребуются обновления, чтобы отразить новые связи протокола.

Формальная схема миграции, чеклист и несколько наблюдаемых прогонов тестовой сети будут сделаны по мере приближения к дате выпуска Streamflow.

## Резюме #################################

В заключение, предложения, содержащиеся в этом документе, направлены на то, чтобы пролить свет на способ масштабирования сети для видео инфраструктуры под названием Livepeer, способ, который отделяет стоимость использования блокчейна Ethereum от стоимости использования самой сети, и который предоставляет существующим разработчикам масштабируемых решений для видео надежность и производительность, требуемые им для инфраструктуры.

Отзывы, идеи и пожелания приветствуются, поэтому, пожалуйста, не стесняйтесь заходить на [Форум Livepeer](https://forum.livepeer.org) или в [Чат Discord](https://discord.gg/RR4kFAh).


## Приложение ################################

### Приложение А. Процесс вероятностных микроплатежей

* Депозит, обеспечивающий безопасность оркестраторов это их доля. Она может быть сокращена, если они попытаются обмануть и результат их работы не пройдет проверку.
* Вещатель (используем сейчас этот термин для обычного пользователя, который может быть скорее разработчиком, чем вещателем) размещает депозит на фиксированное время для покрытия будущей работы, за которую он будет платить сети.
* Вещатель хочет транскодировать видео. В блокчейне он видит реестр оркестраторов, предлагающих свои услуги, и без использования блокчейна договаривается с теми, которые соответствуют его потребностям:
    * Оркестраторы отправляют ему ценовое предложение.
    * Оркестраторы также отправляют ему параметры вероятностного микроплатежа (PM) - они могут варьироваться в зависимости от условий сети Ethereum. Например, они могут установить сумму выигрышного билета таким образом, чтобы стоимость обналичивания составляла менее 1% от полученной стоимости.
* Вещатель отправляет сегменты видео оркестратору(ам), с которым(и) он хочет работать, вместе с PM-билетом.
    * PM-билет - это интерактивный протокол, позволяющий защитить генератор случайных чисел от влияния любой из сторон, так как он используется для определения выигрышного билета - после каждого выигравшего билета оркестратор должен сгенерировать новое случайное число и отправить обязательство вещателю. Скорее всего, это нормальная ситуация, поскольку вещатель и оркестратор к этому момент уже будут отправлять друг другу данные, а это повлечет за собой лишь одно дополнительное сообщение, отправляемое оркестратором каждый раз, когда требуется новое обязательство. Дальнейшая возможная оптимизация заключается в использовании проверяемой случайной функции (verifiable random function, VRF), реализованной в смарт-контракте, в этом случае оркестратор предоставляет вещателю публичный ключ, а оркестратор подписывает полученные билеты соответствующим секретным ключом, VRF-контракт проверяет подлинность подписи, которая затем будет использоваться в качестве источника псевдослучайности. В результате протокол становится неинтерактивным. Нужно будет оценить целесообразность внедрения VRF в смарт-контракт и затраты на проверку этого типа подписи, сейчас же можно не сосредотачиваться на этом, а оставить это на будущее.
* Вещатель получает транскодированный выходной поток от оркестратора.
    * Вещатель может проверить любые сегменты, которые он захочет проверить.
    * Если работа не проходит проверку, вещатель может предоставить Truebit'у доказательства этого факта, чтобы провести сокращение депозита оркестратора и получить большое вознаграждение за обнаруженное нарушение.
* Если вещатель не получает работу от оркестратора, он просто прекращает отправлять ему сегменты и выбирает другого оркестратора.
* Если оркестратор не получает работающий PM-билет, он просто не выполяет работу и не отправляет полученные данные вещателю.
    * Протокол будет поддерживать сообщения для определенных ошибок, таких как `LowPMBalance` или `SegmentFormatDidntMatchJobInputParams`, чтобы вещатели могли получать полезную информацию для отладки или чтобы их узел мог принимать решения, такие, например, как решение пополнить баланс.
* Оркестратор наблюдает за депозитом вещателя и оценивает риск неуплаты.
    * Простой алгоритм для начала. Если баланс вещателя на слишком низком уровне, оркестратор просто прекращает выполнять работу.
    * Оркестратор обналичивает выигрышные билеты по мере их получения (или ждет, пока газ не станет дешевле, оценивая риск потери вознаграждения).
    
Для полного анализа и спецификации структур данных PM-билетов, предотвращения двойных трат и других идей смотрите [этот документ](https://hackmd.io/uHMFeNSyS_GyzwnO3Ld74A?view).

## Ссылки ###########################################

1. Livepeer Whitepaper (на русском) - Дуг Петканикс, Эрик Тан - <https://github.com/fedorello/wiki/blob/fedorello-patch-1/WHITEPAPER.md>
2. The Video Miner, A Path To Scaling Video Transcoding -Philipp Angele  - <https://medium.com/livepeer-blog/the-video-miner-a-path-to-scaling-video-transcoding-a3487d232a1>
3. Ethereum Probabilistic Micropayments - Gustav Simonson - <https://medium.com/@gustav.simonsson/ethereum-probabilistic-micropayments-ae6e6cd85a06>
4. Electronic Lottery Tickets as Micropayments - Ron Rivest - MIT Lab for Computer Science - <https://people.csail.mit.edu/rivest/pubs/Riv97b.pdf>
5. Decentralized Anonymous Micropayments - A. Chiesa, M. Green, J. Liu, P. Miao, I. Miers and P. Mishra - <https://eprint.iacr.org/2016/1033.pdf>
